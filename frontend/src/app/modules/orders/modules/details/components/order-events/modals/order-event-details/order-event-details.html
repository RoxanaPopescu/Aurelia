<template>

    <require from="app/components/data-section/data-section"></require>
    <require from="./order-event-details.scss"></require>


    <let
        order-event-location.bind="model.event.data.deliveryLocation || model.event.data.pickupLocation || model.event.data.location"
        order-event-contact.bind="model.event.data.deliveryContact || model.event.data.pickupContact || model.event.data.contact"
        order-event-time.bind="
            model.event.eventType.slug === 'order-pickup-eta-provided' ? model.event.data.pickupEta :
            model.event.eventType.slug === 'order-delivery-eta-provided' ? model.event.data.deliveryEta :
            model.event.data.timeOfEvent">
    </let>

    <modal-backdrop close="all"></modal-backdrop>

    <modal-panel name="order-event-details" position="right" close-button.bind="true" close-shortcut.bind="true" scroll validation validation.ref="validation">

        <modal-header scroll-fade="0.3">

            <h1 class="font-largest margin-bottom flex-row" tabindex="-1" autofocus="visible.bind: false">
                ${model.event.eventType.name}
            </h1>

            <h2 class="font-large">
                ${model.event.eventType.description}
            </h2>

        </modal-header>

        <data-section class="margin-bottom" scroll-fade="0.4">

            <div class="flex-row">

                <div class="flex-row flex-basis-1-of-2">

                    <div class="margin-large-right">

                        <div class="opacity-faded margin-bottom" translate>
                            Time
                        </div>

                        <div class="opacity-faded" translate>
                            Location
                        </div>

                    </div>

                    <div class="margin-large-right">

                        <div class="margin-bottom user-select-text" empty-value>
                            ${orderEventTime | dateTime: 'narrow' : false}
                        </div>

                        <div class="margin-bottom user-select-text" empty-value>
                            <template if.bind="orderEventLocation.address">
                                ${orderEventLocation.address.primary}<br>
                                ${orderEventLocation.address.secondary}
                            </template>
                        </div>

                    </div>

                </div>

                <div class="flex-row flex-basis-1-of-2">

                    <div class="margin-large-right">

                        <div class="opacity-faded margin-bottom" translate>
                            Route
                        </div>

                        <div class="opacity-faded" translate>
                            Action by
                        </div>

                    </div>

                    <div>

                        <div class="margin-bottom user-select-text" empty-value>
                            <template if.bind="model.event.data.route.slug">
                                <a page-href="path.bind: '/routes/details/' + model.event.data.route.slug" target="_blank">
                                    ${model.event.data.route.slug}
                                </a>
                            </template>
                        </div>

                        <div class="user-select-text" empty-value>
                            <template if.bind="model.event.data.actionBy.user != null || model.event.data.actionBy.organization != null">
                                <div>${model.event.data.actionBy.user.fullName}</div>
                                <div>${model.event.data.actionBy.organization.name}</div>
                            </template>
                        </div>

                    </div>

                </div>

            </div>

        </data-section>

        <!-- Contact -->
        <template if.bind="orderEventContact != null">

            <hr class="hr-line margin-bottom">

            <data-section class="margin-bottom" toggle.bind="true">

                <div slot="header" translate>
                    Contact
                </div>

                <div class="flex-row margin-bottom">

                    <div>
                        <div if.bind="orderEventContact.companyName" class="margin-bottom margin-large-right opacity-faded" translate>
                            Company
                        </div>
                        <div if.bind="orderEventContact.fullName" class="margin-bottom margin-large-right opacity-faded" translate>
                            Name
                        </div>
                        <div if.bind="orderEventContact.email" class="margin-bottom margin-large-right opacity-faded" translate>
                            Email
                        </div>
                        <div if.bind="orderEventContact.phone" class="margin-large-right opacity-faded" translate>
                            Phone
                        </div>
                    </div>

                    <div>
                        <div if.bind="orderEventContact.companyName" class="margin-bottom user-select-text">
                            ${orderEventContact.companyName}
                        </div>
                        <div if.bind="orderEventContact.fullName" class="margin-bottom user-select-text">
                            ${orderEventContact.fullName}
                        </div>
                        <div if.bind="orderEventContact.email" class="margin-bottom user-select-text">
                            <a href="mailto:${orderEventContact.email}" class="user-select-text">
                                ${orderEventContact.email}
                            </a>
                        </div>
                        <div if.bind="orderEventContact.phone" class="user-select-text">
                            <a href="${orderEventContact.phone | phone: 'rfc3966'}" class="user-select-text">
                                ${orderEventContact.phone | phone}
                            </a>
                        </div>
                    </div>

                </div>

            </data-section>

        </template>

        <!-- Driver -->
        <template if.bind="model.event.data.driver != null">

            <hr class="hr-line margin-bottom">

            <data-section class="margin-bottom" toggle.bind="true">

                <div slot="header" translate>
                    Driver
                </div>

                <div class="flex-row margin-bottom">

                    <div>
                        <div if.bind="model.event.data.driver.executor.name" class="margin-bottom margin-large-right opacity-faded" translate>
                            Company
                        </div>
                        <div if.bind="model.event.data.driver.fullName" class="margin-bottom margin-large-right opacity-faded" translate>
                            Name
                        </div>
                        <div if.bind="model.event.data.driver.email" class="margin-bottom margin-large-right opacity-faded" translate>
                            Email
                        </div>
                        <div if.bind="model.event.data.driver.phone" class="margin-large-right opacity-faded" translate>
                            Phone
                        </div>
                    </div>

                    <div>
                        <div if.bind="model.event.data.driver.executor.name" class="margin-bottom user-select-text">
                            ${model.event.data.driver.executor.name}
                        </div>
                        <div if.bind="model.event.data.driver.fullName" class="margin-bottom user-select-text">
                            ${model.event.data.driver.fullName}
                        </div>
                        <div if.bind="model.event.data.driver.email" class="margin-bottom user-select-text">
                            <a href="mailto:${model.event.data.driver.email}" class="user-select-text">
                                ${model.event.data.driver.email}
                            </a>
                        </div>
                        <div if.bind="model.event.data.driver.phone" class="user-select-text">
                            <a href="${model.event.data.driver.phone | phone: 'rfc3966'}" class="user-select-text">
                                ${model.event.data.driver.phone | phone}
                            </a>
                        </div>
                    </div>

                </div>

            </data-section>

        </template>

        <!-- Collo -->
        <template if.bind="model.event.data.collo != null">

            <hr class="hr-line margin-bottom">

            <data-section class="margin-bottom" toggle.bind="true">

                <div slot="header" translate>
                    Collo
                </div>

                <div class="flex-row margin-bottom">

                    <div>
                        <div class="margin-large-right opacity-faded" translate>
                            Barcode
                        </div>
                    </div>

                    <div>
                        <div class="user-select-text">
                            ${model.event.data.collo.barcode}
                        </div>
                    </div>

                </div>

                <tags-input if.bind="model.event.data.collo.tags.length > 0" label="above" readonly.bind="true" class="--tags-only">

                    <div slot="heading">
                        Tags
                    </div>

                    <div slot="value">
                        <tag repeat.for="tag of model.event.data.collo.tags">
                            ${tag}
                        </tag>
                    </div>

                </tags-input>

            </data-section>

        </template>

        <!-- Deviation -->
        <template if.bind="model.event.data.deviation != null">

            <hr class="hr-line margin-bottom">

            <data-section class="margin-bottom" toggle.bind="true">

                <div slot="header" translate>
                    Deviation
                </div>

                <div class="flex-row margin-bottom">

                    <div>
                        <div if.bind="model.event.data.deviation.name" class="margin-bottom margin-large-right opacity-faded" translate>
                            Name
                        </div>
                        <div if.bind="model.event.data.deviation.description" class="margin-large-right opacity-faded" translate>
                            Driver note
                        </div>
                    </div>

                    <div>
                        <div if.bind="model.event.data.deviation.name" class="margin-bottom">
                            ${model.event.data.deviation.name}
                        </div>
                        <div if.bind="model.event.data.deviation.description">
                            ${model.event.data.deviation.description}
                        </div>
                    </div>

                </div>

                <div if.bind="model.event.data.deviation.imageIds.length > 0">

                    <div class="margin-small-bottom opacity-faded" translate>
                        Photo documentation
                    </div>

                    <div>

                        <template repeat.for="imageId of model.event.data.deviation.imageIds">
                            <let image-info.bind="imageId | imageInfo: true"></let>
                            <a
                                modal-href="modal: image; model.bind: { imageUrl: imageInfo.url };"
                                class="margin-right-large">
                                <img class="image-thumbnail" src.bind="imageInfo.url">
                            </a>
                        </template>

                    </div>

                </div>

            </data-section>

        </template>

        <!-- Photo of delivery -->
        <template if.bind="model.event.data.photo != null">

            <hr class="hr-line margin-bottom">

            <data-section class="margin-bottom" toggle.bind="true">

                <div slot="header" translate>
                    Photo of delivery
                </div>

                <div if.bind="!model.event.data.photo" class="opacity-faded" translate>
                    Photo required, but not yet captured
                </div>

                <template if.bind="model.event.data.photo.imageId">

                    <div class="flex-row margin-bottom">

                        <div class="margin-large-right opacity-faded" translate>
                            Date
                        </div>

                        <div>
                            ${model.event.data.photo.date | dateTime: 'narrow' : false}
                        </div>

                    </div>

                    <let image-info.bind="model.event.data.photo.imageId | imageInfo: false"></let>
                    <a modal-href="modal: image; model.bind: { imageUrl: imageInfo.url };">
                        <img if.bind="model.event.data.photo" class="image-thumbnail" src.bind="imageInfo.url">
                    </a>

                </template>

            </data-section>

        </template>

        <!-- Signature -->
        <template if.bind="model.event.data.signature != null">

            <hr class="hr-line margin-bottom">

            <data-section class="margin-bottom" toggle.bind="true" toggle.bind="true">

                <div slot="header" translate>
                    Signature
                </div>

                <div class="flex-row margin-bottom">

                    <div>
                        <div class="margin-bottom margin-large-right opacity-faded" translate>
                            Date
                        </div>
                        <div class="margin-large-right opacity-faded" translate>
                            Name
                        </div>
                    </div>

                    <div>
                        <div class="margin-bottom">
                            ${model.event.data.signature.date | dateTime: 'narrow' : false}
                        </div>
                        <div>
                            ${model.event.data.signature.name}
                        </div>
                    </div>

                </div>

                <div class="flex-row flex-basis-1-of-6">
                    <let image-info.bind="model.event.data.signature.imageId | imageInfo: true"></let>
                    <a modal-href="modal: image; model.bind: { imageUrl: imageInfo.url };">
                        <img class="image-thumbnail" src.bind="imageInfo.url">
                    </a>
                </div>

            </data-section>

        </template>

    </modal-panel>

</template>
