<template>

    <require from="app/components/name-value-pair/name-value-pair"></require>
    <require from="app/components/star-icon/star-icon"></require>
    <require from="./components/order-events/order-events"></require>
    <require from="./components/order-overview/order-overview"></require>
    <require from="./components/order-colli/order-colli"></require>
    <require from="./components/route-overview/route-overview"></require>
    <require from="./details.scss"></require>

    <page name="details">

        <page-sidebar name="orders-details-page-sidebar" scroll>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Order information
                </div>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        ID
                    </div>

                    <div slot="value" empty-value>
                        ${orderId}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Related order ID
                    </div>

                    <div slot="value" empty-value>
                        ${order.relationalId}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Status
                    </div>

                    <div slot="value" empty-value>
                        ${order.state.status.name}
                    </div>

                </name-value-pair>

            </page-section>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Pickup
                </div>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Name
                    </div>

                    <div slot="value" empty-value>
                        ${order.pickup.contactName}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Company name
                    </div>

                    <div slot="value" empty-value>
                        ${order.pickup.companyName}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Address
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.pickup.location.address"
                            innerhtml.bind="order.pickup.location.address.toHtmlString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Phone
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.pickup.contactPhoneNumber != null"
                            innerhtml.bind="order.pickup.contactPhoneNumber.toString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Earliest
                    </div>

                    <div slot="value" empty-value>
                        ${order.pickup.appointment.earliestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Latest
                    </div>

                    <div slot="value" empty-value>
                        ${order.pickup.appointment.latestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair>
                    <div slot="name" translate>
                        Instructions
                    </div>
                </name-value-pair>

                <name-value-pair>
                    <div slot="value" class="text-align-left white-space-pre-line" empty-value>
                        ${order.pickup.instructions}
                    </div>
                </name-value-pair>

            </page-section>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Delivery
                </div>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Name
                    </div>

                    <div slot="value" empty-value>
                        ${order.delivery.contactName}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Company name
                    </div>

                    <div slot="value" empty-value>
                        ${order.delivery.companyName}
                    </div>

                </name-value-pair>

                <name-value-pair>

                    <div slot="name" translate>
                        Address
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.delivery.location.address"
                            innerhtml.bind="order.delivery.location.address.toHtmlString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Phone
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.delivery.contactPhoneNumber != null"
                            innerhtml.bind="order.delivery.contactPhoneNumber.toString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Earliest
                    </div>

                    <div slot="value" empty-value>
                        ${order.delivery.appointment.earliestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Latest
                    </div>

                    <div slot="value" empty-value>
                        ${order.delivery.appointment.latestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair>
                    <div slot="name" translate>
                        Instructions
                    </div>
                </name-value-pair>

                <name-value-pair>
                    <div slot="value" class="text-align-left white-space-pre-line" empty-value>
                        ${order.delivery.instructions}
                    </div>
                </name-value-pair>

            </page-section>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Tags
                </div>

                <div if.bind="order == null || order.tags.length == 0" empty-value></div>

                <tags-input if.bind="order.tags.length > 0" readonly.bind="true" class="--tags-only">

                    <div slot="value">
                        <tag repeat.for="tag of order.tags">
                            ${tag}
                        </tag>
                    </div>

                </tags-input>

            </page-section>

        </page-sidebar>

        <page-content scroll scroll.ref="scroll">

            <page-header scroll-fade>

                <h1 class="font-largest margin-bottom">

                    <path-nav>

                        <a accent="inherit" href="/orders" translate>
                            Orders
                        </a>

                        <span class="user-select-text" if.bind="order.slug != null">
                            ${order.slug}
                            <star-icon entity.bind="order"></star-icon>
                        </span>

                        <div if.bind="order.slug == null" class="text-skeleton" style="width: 240rem;"></div>

                    </path-nav>

                </h1>

                <toolbar>

                    <tab-nav appearance="solid" value.bind="tab">

                        <tab name="events" invalid.bind="eventsValidation.invalid" translate>
                            Events
                        </tab>

                        <tab name="colli" invalid.bind="colliValidation.invalid" translate>
                            Colli
                        </tab>

                        <tab name="route" disabled.bind="!routeSlug || isRemovingOrderFromRoute" invalid.bind="routeValidation.invalid">
                            <span if.bind="loadingRouteInfo" translate>
                                Loading route...
                            </span>
                            <span if.bind="!loadingRouteInfo && routeSlug" translate>
                                Route ${routeSlug}
                            </span>
                            <span if.bind="!loadingRouteInfo && !routeSlug" translate>
                                No linked route
                            </span>
                        </tab>

                    </tab-nav>

                    <div class="control-row flex-push-right" if.bind="order != null">

                        <div if.bind="routeId != null">
                            <select-button
                                if-claims="edit-routes"
                                disabled.bind="order.status.slug == 'ready' || isRemovingOrderFromRoute"
                                appearance="outline"
                                accent="primary">

                                <div slot="label" translate>
                                    Remove from route
                                </div>

                                <item click.trigger="onRemoveFromRouteItemClick('manual-dispatch')" model="manual-dispatch" translate>
                                    Manual dispatch
                                </item>

                                <item click.trigger="onRemoveFromRouteItemClick('automatic-dispatch')" model="automatic-dispatch" translate>
                                    Automatic dispatch
                                </item>

                            </select-button>
                        </div>

                        <select-button
                            disabled.bind="order == null"
                            if-claims="edit-orders"
                            appearance="outline"
                            accent="primary">

                            <div slot="label" translate>
                                Change status
                            </div>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('placed')" model="placed" translate>
                                Placed
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('validated')" model="validated" translate>
                                Validated
                            </item>

                            <item disabled.bind="order.state.status.slug != 'delivered'" click.trigger="onStatusItemClick('ready')" model="ready" translate>
                                Ready
                            </item>

                            <item disabled.bind="!['placed', 'ready'].includes(order.state.status.slug)" click.trigger="onStatusItemClick('cancelled')" model="cncelled" translate>
                                Cancelled
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('in-route-planning')" model="in-route-planning" translate>
                                In route planning
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('route-planned')" model="route-planned" translate>
                                Route planned
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('delivered')" model="delivered" translate>
                                Delivered
                            </item>

                        </select-button>

                        <button
                            if-claims="edit-orders"
                            disabled.bind="!order.state.canBeEdited"
                            appearance="outline"
                            accent="primary"
                            click.trigger="onEditOrderClick()"
                            translate>
                            Edit order
                        </button>

                    </div>

                </toolbar>

            </page-header>

            <order-overview show.bind="tab === 'events'" order.bind="order"></order-overview>

            <order-events
                if.bind="tab === 'events'"
                order.bind="order">
            </order-events>

            <order-colli
                if.bind="tab === 'colli'"
                order.bind="order">
            </order-colli>

            <route-overview
                if.bind="tab === 'route'"
                id.bind="routeSlug"
                order.bind="order">
            </route-overview>

        </page-content>

    </page>

</template>
