<template>

    <require from="app/components/name-value-pair/name-value-pair"></require>
    <require from="./components/events/events"></require>
    <require from="./components/order-overview/order-overview"></require>
    <require from="./components/colli/colli"></require>
    <require from="./components/route-overview/route-overview"></require>
    <require from="./details.scss"></require>

    <page name="details">

        <page-sidebar scroll>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Order information
                </div>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        ID
                    </div>

                    <div slot="value" empty-value>
                        ${orderId}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Related order ID
                    </div>

                    <div slot="value" empty-value>
                        ${order.relationalId}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Status
                    </div>

                    <div slot="value" empty-value>
                        ${order.state.status.name}
                    </div>

                </name-value-pair>

            </page-section>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Pickup
                </div>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Name
                    </div>

                    <div slot="value" empty-value>
                        ${order.pickup.contactName}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Address
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.pickup.location.address"
                            innerhtml.bind="order.pickup.location.address.toHtmlString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Phone
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.pickup.contactPhoneNumber != null"
                            innerhtml.bind="order.pickup.contactPhoneNumber.toString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Earliest
                    </div>

                    <div slot="value" empty-value>
                        ${order.pickup.appointment.earliestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Latest
                    </div>

                    <div slot="value" empty-value>
                        ${order.pickup.appointment.latestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair>
                    <div slot="name" translate>
                        Instructions
                    </div>
                </name-value-pair>

                <name-value-pair>
                    <div slot="value" class="text-align-left white-space-pre-line" empty-value>
                        ${order.pickup.instructions}
                    </div>
                </name-value-pair>

            </page-section>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Delivery
                </div>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Name
                    </div>

                    <div slot="value" empty-value>
                        ${order.delivery.contactName}
                    </div>

                </name-value-pair>

                <name-value-pair>

                    <div slot="name" translate>
                        Address
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.delivery.location.address"
                            innerhtml.bind="order.delivery.location.address.toHtmlString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Phone
                    </div>

                    <div slot="value" empty-value>
                        <span
                            if.bind="order.delivery.contactPhoneNumber != null"
                            innerhtml.bind="order.delivery.contactPhoneNumber.toString()">
                        </span>
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Earliest
                    </div>

                    <div slot="value" empty-value>
                        ${order.delivery.appointment.earliestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair class="margin-bottom">

                    <div slot="name" translate>
                        Latest
                    </div>

                    <div slot="value" empty-value>
                        ${order.delivery.appointment.latestArrivalDate | dateTime: 'narrow' : false}
                    </div>

                </name-value-pair>

                <name-value-pair>
                    <div slot="name" translate>
                        Instructions
                    </div>
                </name-value-pair>

                <name-value-pair>
                    <div slot="value" class="text-align-left white-space-pre-line" empty-value>
                        ${order.delivery.instructions}
                    </div>
                </name-value-pair>

            </page-section>

            <page-section toggle.bind="true">

                <div slot="header" translate>
                    Tags
                </div>

                <div if.bind="order == null || order.tags.length == 0" empty-value></div>

                <tags-input if.bind="order.tags.length > 0" readonly.bind="true" class="--tags-only">

                    <div slot="value">
                        <tag repeat.for="tag of order.tags">
                            ${tag}
                        </tag>
                    </div>

                </tags-input>

            </page-section>

        </page-sidebar>

        <page-content scroll scroll.ref="scroll">

            <page-header scroll-fade>

                <h1 class="font-largest margin-bottom">

                    <path-nav>

                        <a accent="inherit" href="/orders" translate>
                            Orders
                        </a>

                        <span if.bind="order.slug != null">
                            ${order.slug}
                        </span>

                        <div if.bind="order.slug == null" class="text-skeleton" style="width: 60rem"></div>

                    </path-nav>

                </h1>

                <toolbar>

                    <tab-nav appearance="solid" value.bind="tab">

                        <tab name="events" invalid.bind="eventsValidation.invalid" translate>
                            Events
                        </tab>

                        <tab name="colli" invalid.bind="colliValidation.invalid" translate>
                            Colli
                        </tab>

                        <tab name="route" disabled.bind="!routeId" invalid.bind="routeValidation.invalid">
                            <span if.bind="loadingRouteId" translate>
                                Loading route...
                            </span>
                            <span if.bind="!loadingRouteId && routeId" translate>
                                Route ${routeId}
                            </span>
                            <span if.bind="!loadingRouteId && !routeId" translate>
                                No linked route
                            </span>
                        </tab>

                    </tab-nav>

                    <div class="flex-push-right control-row" if.bind="order">

                        <select-button disabled.bind="order == null" if-claims="edit-order" appearance="outline" accent="primary">

                            <div slot="label" translate>
                                Change status
                            </div>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('placed')" translate>
                                Placed
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('validated')" translate>
                                Validated
                            </item>

                            <item disabled.bind="order.state.status.slug != 'delivered'" click.trigger="onStatusItemClick('ready')" translate>
                                Ready
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('cancelled')" translate>
                                Cancelled
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('in-route-planning')" translate>
                                In route planning
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('route-planned')" translate>
                                Route planned
                            </item>

                            <item disabled.bind="true" click.trigger="onStatusItemClick('delivered')" translate>
                                Delivered
                            </item>

                        </select-button>

                        <button if-claims="edit-order" disabled.bind="!order.state.canBeEdited" appearance="outline" accent="primary" click.trigger="onEditOrderClick()">
                            <template if.bind="order.state.canBeEdited" translate>
                                Edit order
                            </template>
                            <template if.bind="!order.state.canBeEdited" translate>
                                Not possible to edit
                            </template>
                        </button>

                    </div>

                </toolbar>

            </page-header>

            <order-overview show.bind="tab === 'events'" order.bind="order"></order-overview>

            <events
                if.bind="tab === 'events'"
                order.bind="order"
                validation
                validation.ref="eventsValidation">
            </events>

            <colli
                if.bind="tab === 'colli'"
                order.bind="order"
                validation
                validation.ref="colliValidation">
            </colli>

            <route-overview
                if.bind="tab === 'route'"
                id.bind="routeId"
                order.bind="order"
                validation
                validation.ref="routeValidation">
            </route-overview>

        </page-content>

    </page>

</template>
