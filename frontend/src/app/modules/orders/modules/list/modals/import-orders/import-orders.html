<template>

    <require from="./import-orders.scss"></require>
    <require from="app/components/file-dropzone/file-dropzone"></require>

    <modal-backdrop close="all"></modal-backdrop>

    <modal-panel name="import-orders" position="right" close-button.bind="true" close-shortcut.bind="true" scroll>

        <modal-header scroll-fade>

            <h1 class="font-largest" tabindex="-1" autofocus="visible.bind: false">
                <path-nav>

                    <span if.bind="view === 'upload'" translate>
                        Import orders
                    </span>

                    <span if.bind="view === 'errors'" translate>
                        Could not import orders
                    </span>

                </path-nav>
            </h1>

        </modal-header>

        <template if.bind="view === 'upload'">

            <modal-section class="margin-bottom">

                <div class="font-large margin-bottom" translate>
                    Here you can import orders by uploading a file
                </div>

                <div translate>
                    Note that the file must be an Excel file (.xlsx), formatted according to our
                    <a download href="/app/modules/orders/modules/list/modals/import-orders/resources/templates/mover-orders-template.xlsx">Template</a>.
                </div>

            </modal-section>

            <modal-section class="order-import-dropzone-section">

                <file-dropzone
                    dropzone.bind="dropzone"
                    options.bind="dropzoneOptions">

                    <div class="order-import-dropzone-content font-base" accent="primary">

                        <icon name="import" class="font-largest margin-right"></icon>

                        <div class="text-align-left" translate>
                            To import orders, drag and drop your file here,<br>
                            or click to choose a file
                        </div>

                    </div>

                </file-dropzone>

            </modal-section>

        </template>

        <template if.bind="view === 'errors'">

            <modal-section>

                <div class="font-large margin-bottom" translate>
                    The uploaded file appears to contain errors
                </div>

                <div translate>
                    Please correct the errors, then try uploading the file again.
                </div>

                <div class="margin-large-top">
                    <button appearance="solid" accent="primary" click.trigger="reset()" translate>
                        Upload new file
                    </button>
                </div>

            </modal-section>

            <modal-section class="--line-above">

                <div class="font-large margin-bottom" translate>
                    Errors found in the uploaded file
                </div>

                <div class="margin-bottom" translate>
                    Note that the file must be formatted according to our
                    <a download href="/app/modules/orders/modules/list/modals/import-orders/resources/templates/mover-orders-template.xlsx">Template</a>.
                </div>

                <data-table
                    appearance="rows"
                    selection="none"
                    sorting.bind="sorting">

                    <data-table-headers>

                        <!-- Enable this if using selection "multiple"

                        <template replace-part="toggle-all">
                            <data-table-cell name="fixed" sort-direction="descending">
                                <span class="text-truncate" translate>
                                    Fixed
                                </span>
                            </data-table-cell>
                        </template>

                        -->

                        <data-table-cell name="range.fromRow" sort-direction="ascending">
                            <span class="text-truncate" translate>
                                Row
                            </span>
                        </data-table-cell>

                        <data-table-cell name="range.fromColumn" sort-direction="ascending">
                            <span class="text-truncate" translate>
                                Column
                            </span>
                        </data-table-cell>

                        <data-table-cell></data-table-cell>

                        <data-table-cell name="description" sort-direction="ascending">
                            <span class="text-truncate" translate>
                                Error description
                            </span>
                        </data-table-cell>

                    </data-table-headers>

                    <template repeat.for="error of orderedErrors">

                        <data-table-row
                            selected.bind="error.fixed"
                            toggle.call="sorting = { property: sorting.property, direction: sorting.direction }"
                            accent.bind="error.fixed ? 'positive' : 'negative'">

                            <data-table-cell align="right">
                                <span class="text-truncate" empty-value>
                                    <template if.bind="error.range != null">
                                        ${
                                            error.range.fromRow === error.range.toRow
                                            ? error.range.fromRow
                                            : error.range.fromRow + " – " + error.range.toRow
                                        }
                                    </template>
                                </span>
                            </data-table-cell>

                            <data-table-cell align="right">
                                <span class="text-truncate" empty-value>
                                    <template if.bind="error.range != null">
                                        ${
                                            error.range.fromColumn === error.range.toColumn
                                            ? error.range.fromColumn
                                            : error.range.fromColumn + " – " + error.range.toColumn
                                        }
                                    </template>
                                </span>
                            </data-table-cell>

                            <data-table-cell></data-table-cell>

                            <data-table-cell>
                                <span class="text-truncate" empty-value>
                                    ${error.description}
                                </span>
                            </data-table-cell>

                        </data-table-row>

                    </template>

                </data-table>

            </modal-section>

        </template>

    </modal-panel>

</template>
