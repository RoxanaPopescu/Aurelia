<template>

    <require from="./overview.scss"></require>
    <require from="app/components/linear-meter/linear-meter"></require>
    <require from="app/components/circular-meter/circular-meter"></require>

    <page-section>

        <div class="control-row">

            <!-- 1st card -->
            <card class="flex-basis-1-of-4 text-align-center --non-clickable">

                <div class="font-small opacity-faded" translate>
                    Delivered orders
                </div>

                <circular-meter accent.bind="failedStops.length > 0 ? 'negative' : 'neutral' & attr" percentage.bind="completedStops * 100 / notCancelledStops">

                    <div>

                        <div class="font-largest">
                            <span empty-value>${completedStops}</span>/<span empty-value>${notCancelledStops}</span>
                        </div>

                        <div if.bind="failedCancelledStops.length > 0" accent="neutral" class="font-small margin-top" translate>
                            ${failedCancelledStops.length} issues
                        </div>

                    </div>

                </circular-meter>

            </card>

            <!-- 2nd card -->
            <card class="flex-basis-1-of-4 text-align-center --non-clickable">

                <!-- Top section -->
                <div class="card-section-top card-section">

                    <div class="font-small opacity-faded">

                        <span if.bind="route.status.slug !== 'completed' && route.status.slug !== 'in-progress'" translate>
                            Total orders count
                        </span>

                        <span if.bind="route.status.slug === 'completed' || route.status.slug === 'in-progress'" translate>
                            Colli picked up
                        </span>

                    </div>

                    <div class="font-largest">

                        <span if.bind="route.status.slug !== 'completed' && route.status.slug !== 'in-progress'" empty-value>
                            ${totalColliCount}
                        </span>

                        <span if.bind="route.status.slug === 'completed' || route.status.slug === 'in-progress'" empty-value>
                            ${pickedUpColliCount}
                        </span>

                    </div>

                    <div class="font-small">

                        <span if.bind="(route == null || totalColliCount === 0) && (route.status.slug === 'completed' || route.status.slug === 'in-progress')">
                            &nbsp;
                        </span>

                        <template if.bind="route.status.slug === 'completed' || route.status.slug === 'in-progress'">

                            <span if.bind="route != null && totalColliCount > 0 && notPickedUpColli.length === 0" translate>
                                All colli picked up
                            </span>

                            <span if.bind="route != null && totalColliCount > 0 && notPickedUpColli.length > 0" accent="negative" translate>
                                ${notPickedUpColli.length} failed
                            </span>

                        </template>

                    </div>

                </div>

                <hr class="hr-line margin">

                <!-- Bottom section -->
                <div class="card-section-bottom card-section">

                    <div class="font-small opacity-faded" translate>
                        Colli delivered
                    </div>

                    <div class="font-largest">

                        <span if.bind="route.status.slug !== 'completed' && route.status.slug !== 'in-progress'" empty-value></span>

                        <span if.bind="route.status.slug === 'completed' || route.status.slug === 'in-progress'" empty-value>
                            ${deliveredColliCount}
                        </span>

                    </div>

                    <div class="font-small">

                        <span if.bind="(route == null || totalColliCount === 0) && (route.status.slug === 'completed' || route.status.slug === 'in-progress')">
                            &nbsp;
                        </span>

                        <template if.bind="route.status.slug === 'completed' || route.status.slug === 'in-progress'">

                            <span if.bind="route != null && totalColliCount > 0 && notDeliveredColli.length === 0" translate>
                                All colli delivered
                            </span>

                            <span if.bind="route != null && totalColliCount > 0 && notDeliveredColli.length > 0" accent="negative" translate>
                                ${notDeliveredColli.length} failed
                            </span>

                        </template>

                    </div>

                </div>
            </card>

            <!-- 3rd card -->
            <card class="flex-basis-1-of-4 text-align-center --non-clickable">

                <!-- Top section -->
                <div class="card-section-top card-section">

                    <div class="font-small opacity-faded">

                        <span if.bind="route.status.slug !== 'completed' && route.status.slug !== 'in-progress'" translate>
                            Scheduled route start
                        </span>

                        <span if.bind="route.status.slug === 'completed' || route.status.slug === 'in-progress'" translate>
                            Route start
                        </span>

                    </div>

                    <div if.bind="route.status.slug === 'completed' || route.status.slug === 'in-progress'" class="font-largest" empty-value>
                        ${route.stops[0].arrivedTime | dateTime: 'narrow' : false}
                    </div>

                    <div if.bind="route.status.slug !== 'completed' && route.status.slug !== 'in-progress'" class="font-largest" empty-value>
                        ${route.stops[0].estimates.arrivedTime | dateTime: 'narrow' : false}
                    </div>

                    <div class="font-small">
                        &nbsp;
                    </div>

                </div>

                <hr class="hr-line margin">

                <!-- Bottom section -->
                <div class="card-section-bottom card-section">

                    <div class="font-small opacity-faded" translate>
                        Route duration
                    </div>

                    <div class="font-largest" empty-value>
                        ${routeDuration | duration: 'narrow'}
                    </div>

                    <div class="font-small">
                        &nbsp;
                    </div>

                </div>

            </card>

            <!-- 4th card -->
            <card class="flex-basis-1-of-4 text-align-center --non-clickable">

                <!-- Top section -->
                <div class="card-section-top card-section">

                    <div class="font-small opacity-faded" translate>
                        Estimated completion
                    </div>

                    <div class="font-largest">

                        <span empty-value>
                            ${route.estimates.completionTime | time: 'narrow' : false}
                        </span>

                    </div>

                    <div class="font-small">

                        <span if.bind="!(route.status.slug === 'completed' || route.status.slug === 'in-progress') || !earlyStart">
                            &nbsp;
                        </span>

                        <span if.bind="(route.status.slug === 'completed' || route.status.slug === 'in-progress') && earlyStart" accent="negative" translate>
                            Arrived ${earlyStart | duration} too early
                        </span>

                    </div>

                </div>

                <hr class="hr-line margin">

                <!-- Bottom section -->
                <div if.bind="route.status.slug === 'in-progress'" class="card-section-bottom card-section">

                    <div class="font-small opacity-faded" translate>
                        Driver status
                    </div>

                    <div class="font-largest" empty-value>

                        <span if.bind="driverOnline" accent="positive" translate>
                            Online
                        </span>

                        <span if.bind="!driverOnline" accent="negative" translate>
                            Offline
                        </span>

                    </div>

                    <div class="font-small">
                        &nbsp;
                    </div>

                </div>

                <div if.bind="route.status.slug === 'completed'" class="card-section-bottom card-section">

                    <div class="font-small opacity-faded" translate>
                        Rating
                    </div>

                    <div class="font-largest">

                        <template if.bind="route.overallRating != null">
                            <icon class="card-section-ratingStar" name="star"></icon>${route.overallRating}/5
                        </template>

                        <div if.bind="route.overallRating != null" empty-value></div>

                    </div>

                    <div class="font-small">
                        &nbsp;
                    </div>

                </div>

                <div if.bind="route.status.slug !== 'completed' && route.status.slug !== 'in-progress'" class="card-section-bottom card-section">

                    <div class="font-small opacity-faded" translate>
                        Complexity
                    </div>

                    <div class="font-largest" empty-value>
                        <template if.bind="route.complexity != null">
                            ${route.complexity | number}%
                        </template>
                    </div>

                    <div class="font-small">
                        &nbsp;
                    </div>

                </div>
                <!-- Bottom section end -->

            </card>

        </div>

    </page-section>

</template>
