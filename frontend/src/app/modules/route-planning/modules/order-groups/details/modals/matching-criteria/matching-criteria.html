<template>

    <modal-backdrop close-modal.bind="true"></modal-backdrop>

    <modal-dialog name="matching-criteria" close-button.bind="true" close-shortcut.bind="true" scroll validation validation.ref="validation">

        <modal-header>

            <h1 class="font-larger" tabindex="-1" autofocus="visible.bind: false">

                <span if.bind="create" translate>
                    New matching criteria
                </span>

                <span if.bind="!create" translate>
                    Edit matching criteria
                </span>

            </h1>

        </modal-header>

        <modal-section class="margin-bottom">

            <div class="margin-bottom" translate>
                For orders from one of those consignors…
            </div>

            <tags-input
                value.bind="model.matchingCriteria.organizations"
                label="above"
                filter="auto"
                fixed.bind="true">

                <div slot="heading" translate>
                    Organizations
                </div>

                <div slot="value">
                    <tag repeat.for="organization of model.matchingCriteria.organizations">
                        ${organization.primaryName}
                    </tag>
                </div>

                <item repeat.for="organization of model.organizations" model.bind="organization">
                    ${organization.primaryName}
                </item>

                <div slot="validation">

                    <dependent-validator
                        set-validity.one-time="true"
                        validators.bind="notEmptyValidator">
                    </dependent-validator>

                </div>

            </tags-input>

        </modal-section>

        <modal-section>

            <div class="margin-bottom" translate>
                Match if the order has all the tags…
            </div>

            <tags-input
                value.bind="model.matchingCriteria.tags"
                new.bind="true"
                label="above"
                fixed.bind="true">

                <div slot="heading" translate>
                    Tags
                </div>

                <div slot="value">
                    <tag model.bind="tag" repeat.for="tag of model.matchingCriteria.tags">
                        ${tag}
                    </tag>
                </div>

                <div slot="validation">

                    <dependent-validator
                        set-validity.one-time="true"
                        validators.bind="notEmptyValidator">
                    </dependent-validator>

                </div>

            </tags-input>

            <div class="font-small ${notEmptyValidator.invalid ? 'margin-large-top' : ''}">

                <custom-validator
                    view-model.ref="notEmptyValidator"
                    valid.bind="model.matchingCriteria.organizations.length > 0 || model.matchingCriteria.tags.length > 0">

                    <template replace-part="invalid" translate>
                        Please choose at least one organization or tag.
                    </template>

                </custom-validator>

            </div>

        </modal-section>

        <modal-footer>

            <div class="button-row flex-push-right">

                <button appearance="solid" accent="primary" click.delegate="onSaveClick()">

                   <span if.bind="!create" translate>
                        Done
                    </span>

                </button>

            </div>

        </modal-footer>

    </modal-dialog>

</template>
