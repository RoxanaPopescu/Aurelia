<template>

    <require from="app/components/info-icon/info-icon"></require>

    <require from="./general.scss"></require>

    <page-section>

        <h1 class="font-largest margin-bottom" tabindex="-1" autofocus="visible.bind: false" translate>
            General
        </h1>

        <div class="margin-large-bottom" translate>
            Here you can specify the general settings to use when planning routes.
        </div>

        <text-input label="above" value.bind="settings.name">

            <div slot="heading" translate>
                Name of the rule set
            </div>

            <div slot="validation">

                <required-validator
                    value.bind="settings.name">
                </required-validator>

            </div>

        </text-input>

    </page-section>

    <page-section class="--line-above">

        <div slot="header" translate>
            Limitations
        </div>

        <div class="margin-large-bottom" translate>
            Here you can specify the limitations that should be taken into account when planning routes.
        </div>

        <div class="control-row margin-large-bottom">

            <select-input
                label="above"
                none.bind="false"
                value.bind="selectedUturnStrategy"
                display-value.bind="selectedUturnStrategy.name"
                class="flex-basis-1-of-2">

                <div slot="heading" translate>
                    Strategy for U-turns
                </div>

                <item repeat.for="uturnStrategy of availableUturnStrategies" model.bind="uturnStrategy">
                    ${uturnStrategy.name}
                </item>

                <div slot="validation">

                    <required-validator
                        value.bind="selectedUturnStrategy">
                    </required-validator>

                </div>

            </select-input>

            <select-input
                label="above"
                none.bind="false"
                value.bind="selectedCurbApproachStrategy"
                display-value.bind="selectedCurbApproachStrategy.name"
                class="flex-basis-1-of-2">

                <div slot="heading" translate>
                    Strategy for curb approach
                </div>

                <item repeat.for="curbApproachStrategy of availableCurbApproachStrategies" model.bind="curbApproachStrategy">
                    ${curbApproachStrategy.name}
                </item>

                <div slot="validation">

                    <required-validator
                        value.bind="selectedCurbApproachStrategy">
                    </required-validator>

                </div>

            </select-input>

        </div>

        <div class="control-row margin-large-bottom">

            <number-input
                label="above"
                none.bind="false"
                value.bind="settings.restrictions.timeWindowAdjustmentDelivery.start | scale: 1/60"
                class="flex-basis-1-of-2"
                min.bind="0">

                <div slot="heading">
                    <span translate>
                        Extending the earliest arrival time
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            To plan with early arrival as it can provide better economy on route if previous delivery is acceptable
                        </div>
                    </info-icon>
                </div>

                <span slot="after" class="opacity-faded" translate>
                    min
                </span>

                <div slot="validation">

                    <required-validator
                        value.bind="settings.restrictions.timeWindowAdjustmentDelivery.start">
                    </required-validator>

                    <range-validator
                        active.bind="true"
                        value.bind="settings.restrictions.timeWindowAdjustmentDelivery.start"
                        min.bind="0">
                    </range-validator>

                </div>

            </number-input>

            <number-input
                label="above"
                none.bind="false"
                value.bind="settings.restrictions.timeWindowAdjustmentDelivery.end | scale: 1/60"
                class="flex-basis-1-of-2"
                min.bind="0">

                <div slot="heading">
                    <span translate>
                        Extension of latest arrival time
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            If negative: Extra buffer for latest delivery time, as planned at an earlier interval than what is promised to the customer. If positive: Improved finances, those scheduled at a later delivery interval than what is promised to the customer
                        </div>
                    </info-icon>
                </div>

                <span slot="after" class="opacity-faded">
                    min
                </span>

                <div slot="validation">

                    <required-validator
                        value.bind="settings.restrictions.timeWindowAdjustmentDelivery.end">
                    </required-validator>

                    <range-validator
                        active.bind="true"
                        value.bind="settings.restrictions.timeWindowAdjustmentDelivery.end"
                        min.bind="0">
                    </range-validator>

                </div>

            </number-input>

        </div>

        <div class="control-row margin-large-bottom">

            <number-input
                label="above"
                value.bind="settings.restrictions.maxCalculationTime | scale: 1/60"
                class="flex-basis-1-of-2"
                min.bind="0">

                <div slot="heading">
                    <span translate>
                        Max time for route calculation
                    </span>

                    <info-icon position="right">
                        <div slot="body" translate>
                            The maximum time the route calculation is to perform the calculation itself. Note that if the route optimization is in the middle of a calculation, it will first complete the current calculation before it will finish
                        </div>
                    </info-icon>
                </div>

                <span slot="after" class="opacity-faded" translate>
                    min
                </span>

                <div slot="validation">

                    <required-validator
                        value.bind="settings.restrictions.maxCalculationTime">
                    </required-validator>

                    <range-validator
                        active.bind="true"
                        value.bind="settings.restrictions.maxCalculationTime"
                        min.bind="0"
                        min-inclusive.bind="false">
                    </range-validator>

                </div>

            </number-input>

            <div class="flex-basis-1-of-2"></div>

        </div>

        <div class="control-row">

            <check-toggle
                label="after"
                value.bind="settings.restrictions.ferriesAllowed"
                class="flex-basis-1-of-3">

                <div slot="heading" translate>
                    Allow ferries
                </div>

            </check-toggle>

            <check-toggle
                label="after"
                value.bind="settings.restrictions.privateRoadsAllowed"
                class="flex-basis-1-of-3">

                <div slot="heading" translate>
                    Allow private roads
                </div>

            </check-toggle>

            <check-toggle
                label="after"
                value.bind="settings.restrictions.oneRoutePlanPerStartLocation"
                class="flex-basis-1-of-3">

                <div slot="heading" translate>
                    One route per start location
                </div>

            </check-toggle>

        </div>

    </page-section>

    <page-section class="--line-above">

        <h1 class="font-largest margin-bottom" tabindex="-1" autofocus="visible.bind: false" translate>
            Collection points
        </h1>

        <div class="margin-large-bottom" translate>
            Here you can specify how collection points should be created
        </div>

        <div class="control-row margin-large-bottom">

            <tags-input
                label="above"
                new.bind="true"
                value.bind="settings.collectionPoint.orderTagsAllRequired"
                class="flex-basis-1-of-1">

                <div slot="heading" translate>
                    Create collection points for orders that have all those tags
                </div>

            </tags-input>

        </div>

        <div class="control-row">

            <number-input
                label="above"
                none.bind="false"
                disabled.bind="!(settings.collectionPoint.orderTagsAllRequired.length > 0)"
                value.bind="settings.collectionPoint.preparationTime | scale: 1/60"
                class="flex-basis-1-of-2"
                min.bind="0">

                <div slot="heading">
                    <span translate>
                        Arrive early, so there is time to prepare
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            To plan with early arrival so there is time to prepare the collection point before customers arrive
                        </div>
                    </info-icon>
                </div>

                <span slot="after" class="opacity-faded" translate>
                    min
                </span>

                <div slot="validation">

                    <required-validator
                        enabled.bind="settings.collectionPoint.orderTagsAllRequired.length > 0"
                        value.bind="settings.collectionPoint.preparationTime">
                    </required-validator>

                    <range-validator
                        active.bind="true"
                        value.bind="settings.collectionPoint.preparationTime"
                        min.bind="0">
                    </range-validator>

                </div>

            </number-input>

        </div>

    </page-section>

    <page-section class="--line-above">

        <div slot="header" translate>
            Route creation
        </div>

        <h2 class="margin-large-bottom" translate>
            Here you can specify how the routes should be created, tagged and approved.
        </h2>

        <text-input
            label="above"
            trim.bind="false"
            value.bind="settings.routeCreation.routeNameTemplate"
            class="flex-basis-1-of-2 margin-large-bottom"
            ref="routeNameTempleteInputElement">

            <div slot="heading">
                <span translate>
                    Route reference
                </span>
                <info-icon position="right">
                    <div slot="body" translate>
                        When the route is created, its reference will be set based on this template
                    </div>
                </info-icon>
            </div>

            <div slot="after">

                <select-button appearance="text-without-hover" accent="primary">

                    <div slot="label" class="flex-row">
                        <icon name="placeholder-small" accent="primary" class="margin-right"></icon>
                        <span translate>
                            Insert placeholder
                        </span>
                    </div>

                    <item click.trigger="onRouteNamePlaceholderClick('{DayOfWeek}')" model="day-of-wek">
                        <div accent="primary">
                            {DayOfWeek}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Day of week as letter, A = Monday, B = Tuesday etc.
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{DayOfWeek}')" model="day-of-year">
                        <div accent="primary">
                            {DayOfYear}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Number of days in the year, starting from January 1, eg. 122
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{StartLocation}')" model="start-location">
                        <div accent="primary">
                            {StartLocation}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            First three letters of start location on route
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{EndLocation}')" model="end-location">
                        <div accent="primary">
                            {EndLocation}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            First three letters of end location om route
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{Gate}')" model="gate">
                        <div accent="primary">
                            {Gate}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Gate of the route
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{StartTime}')" model="day-of-wek">
                        <div accent="primary">
                            {StartTime}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Start time of route, eg. 1040
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{Number}')" model="number">
                        <div accent="primary">
                            {Number}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Route number index in optimization, sorted by start time
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{Year}')" model="year">
                        <div accent="primary">
                            {Year}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Year of the day of delivery
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{Month}')" model="month">
                        <div accent="primary">
                            {Month}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Month of the day of delivery
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{Day}')" model="day">
                        <div accent="primary">
                            {Day}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Day of the delivery
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{StartLocationZip1}')" model="start-location-zip-1">
                        <div accent="primary">
                            {StartLocationZip1}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            First character in the zip code on the start location
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{StartLocationZip}')" model="start-location-zip">
                        <div accent="primary">
                            {StartLocationZip}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Full zip code on the start location
                        </div>
                    </item>

                    <item click.trigger="onRouteNamePlaceholderClick('{LastDeliveryZip}')" model="last-delivery-zip">
                        <div accent="primary">
                            {LastDeliveryZip}
                        </div>
                        <div class="font-small margin-smallest-top opacity-faded" translate>
                            Full zip code on last delivery
                        </div>
                    </item>

                </select-button>

            </div>

            <div slot="validation">

                <required-validator
                    value.bind="settings.routeCreation.routeNameTemplate">
                </required-validator>

            </div>

        </text-input>

        <tags-input
            label="above"
            value.bind="settings.routeCreation.routeTags"
            new.bind="true"
            class="margin-large-bottom">

            <div slot="heading" translate>
                Tags to add to the routes
            </div>

        </tags-input>

        <check-toggle label="after" value.bind="settings.routeCreation.manualApproval">

            <span slot="heading">
                <span translate>
                    Approve routes manually
                </span>
                <info-icon position="right">
                    <div slot="body" translate>
                        If selected, the routes will need to be manually approved before being created
                    </div>
                </info-icon>
            </div>

        </check-toggle>

    </page-section>

</template>
