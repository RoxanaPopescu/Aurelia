<template class="flex-grow flex-column min-height-0">

    <require from="app/components/accordion/accordion"></require>
    <require from="app/components/name-value-pair/name-value-pair"></require>
    <require from="legacy/components/special-areas-map/wrapper" as="special-areas-map"></require>

    <require from="./geographic-areas.scss"></require>

    <page-section>

        <h1 class="font-largest margin-bottom" tabindex="-1" autofocus="visible.bind: false" translate>
            Geographic
        </h1>

        <div translate>
            Here you can specify additional settings to use within specific geographic areas.
        </div>

    </page-section>

    <hr class="hr-line">

    <div class="flex-grow flex-row min-height-0">

        <div class="flex-basis-1-of-3 flex-column geographic-areas-list" scroll>

            <page-section class="flex-grow">

                <list-layout if.bind="settings.specialAreas.length > 0">

                    <accordion repeat.for="specialArea of settings.specialAreas" expanded.bind="specialArea.expanded" accent.bind="'data-' + specialArea.color & attr">

                        <div slot="header">

                            <check-toggle class="margin-right" value.bind="specialArea.selected"></check-toggle>

                            <div class="font-large">
                                ${specialArea.name}
                            </div>

                            <div class="flex-push-right icon-row">

                                <button
                                    title.translate="Edit area"
                                    appearance="none"
                                    accent="primary"
                                    disabled.bind="enableDrawing"
                                    click.trigger="onEditAreaClick($index)">

                                    <icon name="edit-small"></icon>

                                </button>

                                <button
                                    title.translate="Delete area"
                                    appearance="none"
                                    accent="primary"
                                    disabled.bind="enableDrawing"
                                    click.trigger="onDeleteAreaClick($index)">

                                    <icon name="delete-small"></icon>

                                </button>

                            </div>

                        </div>

                        <div if.bind="specialArea.scenarios.length > 0">

                            <div
                                repeat.for="scenario of specialArea.scenarios"
                                class="geographic-area-scenario flex-row"
                                inert.bind="enableDrawing"
                                click.trigger="onEditScenarioClick($event, specialArea, $index)">

                                <div class="special-area-scenario-number">
                                    ${$index + 1}
                                </div>

                                <div class="flex-grow">

                                    <div class="geographic-area-scenario-heading margin-bottom">

                                        <div class="flex-grow">
                                            ${scenario.criteria.datePeriod | dateTimeRange: 'narrow'}
                                        </div>

                                        <div class="icon-row">

                                            <button
                                                title.translate="Edit area rule"
                                                appearance="none"
                                                accent="primary"
                                                disabled.bind="enableDrawing">

                                                <icon name="edit-small"></icon>

                                            </button>

                                            <button
                                                title.translate="Delete area rule"
                                                appearance="none"
                                                accent="primary"
                                                disabled.bind="enableDrawing"
                                                click.trigger="onDeleteScenarioClick(specialArea, $index)">

                                                <icon name="delete-small"></icon>

                                            </button>

                                        </div>

                                    </div>

                                    <name-value-pair>

                                        <div slot="name" translate>
                                            Days
                                        </div>

                                        <div slot="value">
                                            <template if.bind="scenario.criteria.weekdays.length === 7" translate>
                                                All days
                                            </template>
                                            <template if.bind="scenario.criteria.weekdays.length < 7">
                                                ${scenario.criteria.weekdays | weekdayList: 'long'}
                                            </template>
                                        </div>

                                    </name-value-pair>

                                    <name-value-pair if.bind="scenario.criteria.orderTagsAllRequired" class="margin-smallest-top">

                                        <div slot="name" translate>
                                            Match all tags
                                        </div>

                                        <div slot="value" class="text-truncate" empty-value>
                                            ${scenario.criteria.orderTagsAllRequired | list: 'short' : 'unit'}
                                        </div>

                                    </name-value-pair>

                                    <name-value-pair if.bind="scenario.criteria.orderTagsOneRequired" class="margin-smallest-top">

                                        <div slot="name" translate>
                                            Match some tags
                                        </div>

                                        <div slot="value" class="text-truncate" empty-value>
                                            ${scenario.criteria.orderTagsOneRequired | list: 'short' : 'unit'}
                                        </div>

                                    </name-value-pair>

                                    <name-value-pair if.bind="scenario.taskTimeChange" class="margin-smallest-top">

                                        <div slot="name" translate>
                                            Task time
                                        </div>

                                        <div slot="value">
                                            ${scenario.taskTimeChange > 0 ? '+' : ''}${scenario.taskTimeChange | number} sec. task time
                                        </div>

                                    </name-value-pair>

                                    <name-value-pair if.bind="scenario.drivingTimeChangeFactor" class="margin-smallest-top">

                                        <div slot="name" translate>
                                            Driving time
                                        </div>

                                        <div slot="value">
                                            ${scenario.drivingTimeChangeFactor > 0 ? '+' : ''}${scenario.drivingTimeChangeFactor | percent} driving time
                                        </div>

                                    </name-value-pair>

                                    <name-value-pair if.bind="scenario.isAreaBlocked" class="margin-smallest-top">

                                        <div slot="value" translate>
                                            Area blocked
                                        </div>

                                    </name-value-pair>

                                </div>

                            </div>

                        </div>

                        <empty-indicator if.bind="specialArea.scenarios.length == 0" size="small" class="margin-larger-bottom">
                            <div slot="heading" translate>
                                No area rules specified
                            </div>
                        </empty-indicator>

                        <button
                            appearance="outline"
                            accent="primary"
                            class="geographic-area-add-button margin-large-top"
                            disabled.bind="enableDrawing"
                            click.trigger="onAddScenarioClick(specialArea)">

                            <icon name="plus-small" class="margin-right"></icon>

                            <span translate>
                                New area rule
                            </span>

                        </button>

                    </accordion>

                </list-layout>

                <empty-indicator if.bind="settings.specialAreas.length == 0" size="medium" icon="empty-map-drawing" class="margin-large-bottom">
                    <div slot="heading" translate>
                        No areas specified
                    </div>
                </empty-indicator>

                <button
                    appearance="outline"
                    accent="primary"
                    class="geographic-area-add-button margin-large-top"
                    disabled.bind="enableDrawing"
                    click.trigger="onAddAreaClick()">

                    <icon name="plus-small" class="margin-right"></icon>

                    <span translate>
                        New area
                    </span>

                </button>

            </page-section>

        </div>

        <special-areas-map
            class="flex-basis-2-of-3"
            areas.bind="visible ? settings.specialAreas : undefined"
            redraw-trigger.bind="mapRedrawTrigger"
            hovered-area.bind="hoveredArea"
            on-area-click.call="onAreaClick(area)"
            enable-drawing.bind="enableDrawing"
            on-drawing-complete.call="onDrawingComplete(polygon)"
            on-drawing-cancelled.call="onDrawingCancelled()">
        </special-areas-map>

    </div>

</template>
