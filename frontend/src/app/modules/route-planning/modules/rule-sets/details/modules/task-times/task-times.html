<template>

    <require from="app/components/info-icon/info-icon"></require>
    <require from="app/components/name-value-pair/name-value-pair"></require>
    <require from="app/components/name-value-list/name-value-list"></require>

    <require from="./task-times.scss"></require>

    <page-section>

        <div class="font-largest margin-bottom" tabindex="-1" autofocus="visible.bind: false" translate>
            Task time
        </div>

        <div translate>
            Here you can specify the amount of time the driver is expected to spend on tasks for each stop for loading and unloading.
        </div>

        <div class="flex-row">

            <div class="flex-basis-1-of-3">

                <div class="flex-row font-larger margin">

                    <div translate>
                        Starting point
                    </div>

                    <button appearance="none" accent="primary" click.trigger="onEditBaseTaskTimeClick()" class="margin-left line-height-1">
                        <icon name="edit"></icon>
                    </button>

                </div>

                <div if.bind="settings.taskTimes.base == null" class="opacity-faded">
                    No base task time specified
                </div>

                <name-value-list if.bind="settings.taskTimes.base != null">

                    <name-value-pair>

                        <div slot="name" translate>
                            Start time
                        </div>

                        <div slot="value">
                            ${settings.taskTimes.base.initial | number} sec
                        </div>

                    </name-value-pair>

                    <name-value-pair>

                        <div slot="name" translate>
                            Time per floor
                        </div>

                        <div slot="value">
                            ${settings.taskTimes.base.perFloor | number} sec
                        </div>

                    </name-value-pair>

                    <name-value-pair>

                        <div slot="name" translate>
                            Time per round
                        </div>

                        <div slot="value">
                            ${settings.taskTimes.base.perRound | number} sec
                        </div>

                    </name-value-pair>

                </name-value-list>

                <div validation validation.ref="baseTaskTimeValidation">

                    <custom-validator
                        valid.bind="settings.taskTimes.base.initial != null"
                        class="font-small margin-medium-top">

                        <template replace-part="invalid" translate>
                            Please provide the base task time.
                        </template>

                    </custom-validator>

                </div>

            </div>

            <div class="flex-basis-1-of-3">

                <div class="flex-row font-larger margin">

                    <div translate>
                        Round limits
                    </div>

                    <button appearance="none" accent="primary" click.trigger="onEditRoundDefinitionClick()" class="margin-left line-height-1">
                        <icon name="edit"></icon>
                    </button>

                </div>

                <div if.bind="settings.taskTimes.roundDefinition == null" class="opacity-faded">
                    No round limits specified
                </div>

                <name-value-list if.bind="settings.taskTimes.roundDefinition != null">

                    <name-value-pair>

                        <div slot="name" translate>
                            Colli per round
                        </div>

                        <div slot="value">
                            ${settings.taskTimes.roundDefinition.colliPerRound | number}
                        </div>

                    </name-value-pair>

                    <name-value-pair>

                        <div slot="name" translate>
                            Weight per round
                        </div>

                        <div slot="value">
                            ${settings.taskTimes.roundDefinition.weightPerRound | number} kg
                        </div>

                    </name-value-pair>

                    <name-value-pair>

                        <div slot="name" translate>
                            Volume per round
                        </div>

                        <div slot="value">
                            ${settings.taskTimes.roundDefinition.volumePerRound | number} mÂ³
                        </div>

                    </name-value-pair>

                </name-value-list>

                <div validation validation.ref="roundDefinitionValidation">

                    <custom-validator
                        valid.bind="settings.taskTimes.roundDefinition != null"
                        class="font-small margin-medium-top">

                        <template replace-part="invalid" translate>
                            Please provide the round limits.
                        </template>

                    </custom-validator>

                </div>

            </div>

        </div>

    </page-section>

    <page-section class="--line-above">

        <div slot="header" class="flex-row">

            <div translate>
                Additional task time rules
            </div>

            <button appearance="outline" accent="primary" class="flex-row font-base --button-position-right" click.trigger="onAddAdditionalTaskTimeClick()">
                <icon name="plus-small" class="margin-right"></icon>
                <span translate>
                    New task time rule
                </span>
            </button>

        </div>

        <div class="flex-row margin-large-bottom" translate>
            Here you can specify the additional time to add when handling orders with specific tags.
        </div>

        <data-table
            appearance="rows"
            class="margin-large-bottom --reduce-header-whitespace">

            <data-table-headers>

                <data-table-cell>
                    <span class="text-truncate" translate>
                        Match criteria
                    </span>
                </data-table-cell>

                <data-table-cell align="right">
                    <span class="text-truncate" translate>
                        Initial time
                    </span>
                </data-table-cell>

                <data-table-cell align="right">
                    <span class="text-truncate" translate>
                        Time per floor
                    </span>
                </data-table-cell>

                <data-table-cell align="right">
                    <span class="text-truncate" translate>
                        Time per round
                    </span>
                </data-table-cell>

                <data-table-cell align="right">
                    <!-- Icons -->
                </data-table-cell>

            </data-table-headers>

            <data-table-row repeat.for="scenario of settings.taskTimes.scenarios" click.call="onEditAdditionalTaskTimeClick($index)">

                <data-table-cell>
                    <span class="text-truncate">

                        <template if.bind="scenario.criteria.orderTagsAllRequired.length > 0">

                            <span if.bind="scenario.criteria.orderTagsAllRequired.length > 0" translate>
                                Orders with all the tags
                            </span>

                            <span if.bind="scenario.criteria.orderTagsAllRequired.length > 0" class="margin-left margin-right">
                                ${scenario.criteria.orderTagsAllRequired | list: 'short' : 'unit'}
                            </span>

                        </template>

                        <template if.bind="scenario.criteria.orderTagsOneRequired.length > 0">

                            <span if.bind="scenario.criteria.orderTagsAllRequired.length > 0" translate>
                                and some of the tags
                            </span>

                            <span if.bind="scenario.criteria.orderTagsAllRequired.length == 0" translate>
                                Orders with some of the tags
                            </span>

                            <span class="margin-left margin-right">
                                ${scenario.criteria.orderTagsOneRequired | list: 'short' : 'unit'}
                            </span>

                        </template>

                    </span>
                </data-table-cell>

                <data-table-cell align="right">
                    <span class="text-truncate">
                        ${scenario.time.initial / 60 | number} min
                    </span>
                </data-table-cell>

                <data-table-cell align="right">
                    <span class="text-truncate">
                        ${scenario.time.perFloor / 60 | number} min
                    </span>
                </data-table-cell>

                <data-table-cell align="right">
                    <span class="text-truncate">
                        ${scenario.time.perRound / 60 | number} min
                    </span>
                </data-table-cell>

                <data-table-cell align="right">

                    <div class="icon-row">

                        <button appearance="none" accent="primary" click.trigger="onDeleteAdditionalTaskTimeClick($index)">
                            <icon name="delete-small"></icon>
                        </button>

                    </div>

                </data-table-cell>

            </data-table-row>

        </data-table>

        <empty-indicator if.bind="settings.taskTimes.scenarios.length == 0" size="medium">

            <div slot="heading" translate>
                No additional task time rules
            </div>

        </empty-indicator>

    </page-section>

</template>
