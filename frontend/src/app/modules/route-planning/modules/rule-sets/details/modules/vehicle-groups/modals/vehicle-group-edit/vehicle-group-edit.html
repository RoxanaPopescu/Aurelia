<template>

    <require from="app/components/address-input/address-input"></require>

    <require from="./vehicle-group-edit.scss"></require>

    <modal-backdrop close="all"></modal-backdrop>

    <modal-panel name="vehicle-group-edit" position="right" close-button.bind="true" close-shortcut.bind="true" scroll validation validation.ref="validation">

        <div slot="actions">

            <button
                if.bind="!isNew"
                appearance="icon"
                title.translate="Save changes"
                click.trigger="onSaveClick()">
                <icon name="save"></icon>
            </button>

        </div>

        <modal-header scroll-fade>

            <h1 class="font-largest" tabindex="-1" autofocus="visible.bind: false">

                <span if.bind="isNew" translate>
                    New vehicle rule
                </span>

                <span if.bind="!isNew" translate>
                    Edit vehicle rule
                </span>

            </h1>

        </modal-header>

        <modal-section>

            <div class="control-row">

                <text-input
                    label="above"
                    value.bind="model.name"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Name
                    </div>

                </text-input>

                <select-input
                    label="above"
                    none.bind="false"
                    value.bind="model.vehicleType"
                    display-value.bind="model.vehicleType.name"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Vehicle type
                    </div>

                    <item repeat.for="vehicleType of vehicleTypes" model.bind="vehicleType">
                        ${vehicleType.name}
                    </item>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.vehicleType">
                        </required-validator>

                    </div>

                </select-input>

            </div>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Cost
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify the costs associated with the vehicle group. The costs are stated in an arbitrary size and the route calculation itself tries to minimize this cost. Therefore, the ratio of the different costs of each vehicle group is what determines which vehicle groups are most appropriate to use.
            </h1>

            <div class="control-row margin-larger-bottom">

                <number-input
                    value.bind="model.cost.newRoute"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading">
                        <span translate>
                            Cost of a new route
                        </span>
                        <info-icon position="right">
                            <div slot="body" translate>
                                This is used, among other things. To adjust how many vehicles one will have in relation to how much time saved by inserting a new vehicle, the higher the value, the fewer routes will be generated at the expense of less efficient routes
                            </div>
                        </info-icon>
                    </div>

                    <span slot="after" class="opacity-faded">
                        per route
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.cost.newRoute">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.cost.newRoute"
                            min.bind="0">
                        </range-validator>

                    </div>

                </number-input>

                <number-input
                    value.bind="model.cost.time | scale: 60"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading">
                        <span translate>
                            Cost of time
                        </span>
                        <info-icon position="left">
                            <div slot="body" translate>
                                Task hour covers: driving time, waiting time and loading and unloading
                            </div>
                        </info-icon>
                    </div>

                    <span slot="after" class="opacity-faded">
                        per min
                    </span>


                    <div slot="validation">

                        <required-validator
                            value.bind="model.cost.time">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.cost.time"
                            min.bind="0">
                        </range-validator>

                    </div>

                </number-input>

            </div>

            <div class="control-row">

                <number-input
                    value.bind="model.cost.distance | scale: 1000"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading">
                        <span translate>
                            Cost of distance driven
                        </span>
                        <info-icon position="right">
                            <div slot="body" translate>
                                The higher the value, the less distance the route will be at the expense of spending more time
                            </div>
                        </info-icon>
                    </div>

                    <span slot="after" class="opacity-faded">
                        per km
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.cost.distance">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.cost.distance"
                            min.bind="0">
                        </range-validator>

                    </div>

                </number-input>

            </div>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Limitations
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify the limitations of the vehicle group.
            </h1>

            <div class="control-row margin-larger-bottom">

                <number-input
                    value.bind="model.limits.volume"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Max volume per route
                    </div>

                    <span slot="after" class="opacity-faded">
                        mÂ³
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.limits.volume">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.limits.volume"
                            min.bind="0"
                            min-inclusive.bind="false">
                        </range-validator>

                    </div>

                </number-input>

                <number-input
                    value.bind="model.limits.weight"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Max weight per route
                    </div>

                    <span slot="after" class="opacity-faded">
                        kg
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.limits.weight">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.limits.weight"
                            min.bind="0"
                            min-inclusive.bind="false">
                        </range-validator>

                    </div>

                </number-input>

            </div>

            <div class="control-row margin-larger-bottom">

                <number-input
                    value.bind="model.limits.colliCount"
                    min.bind="0"
                    step.bind="1"
                    constrain.bind="true"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Max number of colli per route
                    </div>

                    <span slot="after" class="opacity-faded" translate>
                        colli
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.limits.colliCount">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.limits.colliCount"
                            min.bind="0"
                            min-inclusive.bind="false">
                        </range-validator>

                    </div>

                </number-input>

                <number-input
                    value.bind="model.limits.stopCount"
                    min.bind="2"
                    step.bind="1"
                    constrain.bind="true"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading">
                        <span translate>
                            Max number of stops per route
                        </span>
                        <info-icon position="left">
                            <div slot="body" translate>
                                Maximum number of stops on the route, in addition to any Specified start and end address of the vehicle group
                            </div>
                        </info-icon>
                    </div>

                    <span slot="after" class="opacity-faded">
                        stops
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.limits.stopCount">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.limits.stopCount"
                            min.bind="0">
                        </range-validator>

                    </div>

                </number-input>

            </div>

            <div class="control-row margin-larger-bottom">

                <number-input
                    value.bind="model.limits.time | scale: 1/60"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Max time per route
                    </div>

                    <span slot="after" class="opacity-faded">
                        min
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.limits.time">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.limits.time"
                            min.bind="0"
                            min-inclusive.bind="false">
                        </range-validator>

                    </div>

                </number-input>

                <number-input
                    value.bind="model.limits.distance | scale: 1/1000"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Max driving distance per route
                    </div>

                    <span slot="after" class="opacity-faded">
                        km
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.limits.distance">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.limits.distance"
                            min.bind="0"
                            min-inclusive.bind="false">
                        </range-validator>

                    </div>

                </number-input>

            </div>

            <div class="control-row">

                <check-toggle
                    label="after"
                    value.bind="model.handlesCollectionPoint"
                    class="flex-basis-1-of-2">

                    <div slot="heading">
                        Can function as a collection point
                    </div>

                </check-toggle>

            </div>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Locations
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify the location at which the vehicle must be picked up and returned.
            </h1>

            <div class="control-row margin-medium-bottom">

                <address-input
                    label="above"
                    value.bind="model.startLocation.location.address"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Start address
                    </div>

                </address-input>

                <address-input
                    label="above"
                    value.bind="model.endLocation.location.address"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        End address
                    </div>

                </address-input>

            </div>

            <div class="control-row">

                <number-input
                    value.bind="model.startLocation.time | scale: 1/60"
                    disabled.bind="model.startLocation.location.address == null"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Task time at the start address
                    </div>

                    <span slot="after" class="opacity-faded">
                        min
                    </span>

                    <div slot="validation">

                        <required-validator
                            enabled.bind="model.startLocation.location.address != null"
                            value.bind="model.startLocation.time">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.startLocation.time"
                            min.bind="0">
                        </range-validator>

                    </div>

                </number-input>

                <number-input
                    value.bind="model.endLocation.time | scale: 1/60"
                    disabled.bind="model.endLocation.location.address == null"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Task time at the end address
                    </div>

                    <span slot="after" class="opacity-faded">
                        min
                    </span>

                    <div slot="validation">

                        <required-validator
                            enabled.bind="model.endLocation.location.address != null"
                            value.bind="model.endLocation.time">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.endLocation.time"
                            min.bind="0">
                        </range-validator>

                    </div>

                </number-input>

            </div>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Distribution center en route
            </div>

            <h1 class="margin-large-bottom" translate>
               Specify the distribution center to visit while the route is active.
            </h1>

            <div class="control-row margin-medium-bottom">

                <address-input
                    label="above"
                    value.bind="model.distributionCenterEnRoute.location.address"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Address
                    </div>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.distributionCenterEnRoute.location.address"
                            enabled.bind="(model.distributionCenterEnRoute.location.address || model.distributionCenterEnRoute.taskTime || selectedEarliestArrival || selectedLatestDeparture) ? undefined : false">
                        </required-validator>

                    </div>

                </address-input>

                <number-input
                    value.bind="model.distributionCenterEnRoute.taskTime | scale: 1/60"
                    min.bind="0"
                    label="above"
                    class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Task time
                    </div>

                    <span slot="after" class="opacity-faded">
                        min
                    </span>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.distributionCenterEnRoute.taskTime"
                            enabled.bind="(model.distributionCenterEnRoute.location.address || model.distributionCenterEnRoute.taskTime || selectedEarliestArrival || selectedLatestDeparture) ? undefined : false">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="model.distributionCenterEnRoute.taskTime"
                            min.bind="0">
                        </range-validator>

                    </div>

                </number-input>

            </div>

            <div class="control-row">

                <time-input
                    label="above"
                    value.bind="selectedEarliestArrival"
                    class="flex-basis-1-of-2"
                    max.bind="selectedLatestDeparture">

                    <div slot="heading" translate>
                        Earliest arrival
                    </div>

                    <div slot="validation">

                        <required-validator
                            value.bind="selectedEarliestArrival"
                            enabled.bind="(model.distributionCenterEnRoute.location.address || model.distributionCenterEnRoute.taskTime || selectedEarliestArrival || selectedLatestDeparture) ? undefined : false">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="selectedEarliestArrival"
                            max.bind="selectedLatestDeparture"
                            max-inclusive.bind="false">

                            <template replace-part="invalid-max" translate>
                                Please choose a time before the latest departure time.
                            </template>

                        </range-validator>

                    </div>

                </time-input>

                <time-input
                    label="above"
                    value.bind="selectedLatestDeparture"
                    class="flex-basis-1-of-2"
                    min.bind="selectedEarliestArrival">

                    <div slot="heading">
                        <span translate>
                            Latest departure
                        </span>
                    </div>

                    <div slot="validation">

                        <required-validator
                            value.bind="selectedLatestDeparture"
                            enabled.bind="(model.distributionCenterEnRoute.location.address || model.distributionCenterEnRoute.taskTime || selectedEarliestArrival || selectedLatestDeparture) ? undefined : false">
                        </required-validator>

                        <range-validator
                            active.bind="true"
                            value.bind="selectedLatestDeparture"
                            min.bind="selectedEarliestArrival"
                            min-inclusive.bind="false">

                            <template replace-part="invalid-min" translate>
                                Please choose a time after the earliest arrival time.
                            </template>

                        </range-validator>

                    </div>

                </time-input>

            </div>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Order tags
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify the order tags that this vehicle group can handle. If no one is specified, this can handle all orders.
            </h1>

            <tags-input
                class="margin-large-bottom"
                label="above"
                value.bind="model.orderTagsOneRequired"
                new.bind="true">

                <div slot="heading">
                    <span translate>
                        Order must have one of the following tags
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            The order may have multiple tags, but must at least contain all the tags listed in the list below
                        </div>
                    </info-icon>
                </div>

            </tags-input>

            <tags-input
                label="above"
                value.bind="model.orderTagsOneNotAllowed"
                new.bind="true">

                <div slot="heading">
                    <span translate>
                        Order must not have one of the following tags
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            The order may have multiple tags, but may not have any of the tags listed in the list below
                        </div>
                    </info-icon>
                </div>

            </tags-input>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Route tags
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify the tags that should be assigned to routes using this vehicle group.
            </h1>

            <tags-input
                label="above"
                value.bind="model.routeTags"
                new.bind="true">

                <div slot="heading" translate>
                    Route tags to assign
                </div>

            </tags-input>

        </modal-section>

        <div if.bind="isNew" class="button-container margin-larger-top">

            <button appearance="solid" accent="primary" click.trigger="onSaveClick()" translate>
                Create vehicle rule
            </button>

        </div>

    </modal-panel>

</template>
