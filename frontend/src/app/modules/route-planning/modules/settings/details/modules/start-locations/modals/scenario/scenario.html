<template>

    <require from="./scenario.scss"></require>

    <modal-backdrop close="all"></modal-backdrop>

    <modal-panel name="scenario" position="right" close-button.bind="true" close-shortcut.bind="true" scroll validation validation.ref="validation">

        <div slot="actions">

            <button
                if.bind="!isNew"
                appearance="icon"
                title.translate="Save changes"
                click.trigger="onSaveClick()">
                <icon name="save"></icon>
            </button>

        </div>

        <modal-header scroll-fade>

            <h1 class="font-largest margin-medium-bottom" tabindex="-1" autofocus="visible.bind: false">
                <span if.bind="model.isNew" translate>
                    Create reservation
                </span>
                <span if.bind="!model.isNew" translate>
                    Edit reservation
                </span>
            </h1>

            <h1 tabindex="-1" autofocus="visible.bind: false">
                Lorem ipsum
            </h1>

        </modal-header>

        <modal-section if.bind="model.vehicleGroups.length === 0">

            <info-card accent="attention" title="Vehicle groups missing">
                You cannot make a reservation before having a vehicle group.
            </info-card>

        </modal-section>

        <template if.bind="model.vehicleGroups.length > 0">

            <modal-section>

                <div class="control-row margin-large-bottom">

                    <text-input label="above" value.bind="model.scenario.name" class="flex-basis-1-of-2">

                        <div slot="heading" translate>
                            Name
                        </div>

                    </text-input>

                    <select-input
                        label="above"
                        none.bind="false"
                        value.bind="model.scenario.gates[0]"
                        display-value.bind="model.scenario.gates[0].name"
                        class="flex-basis-1-of-2">

                        <div slot="heading" translate>
                            Gate name
                        </div>

                        <item repeat.for="gateName of gateNames" model.bind="gateName">
                            ${gateName}
                        </item>

                        <div slot="validation">

                            <required-validator
                                value.bind="model.scenario.gates[0]">
                            </required-validator>

                        </div>

                    </select-input>

                </div>

                <div class="control-row margin-large-bottom">

                    <select-input
                        label="above"
                        none.bind="false"
                        value.bind="selectedVehicleGroup"
                        display-value.bind="selectedVehicleGroup.name"
                        class="flex-basis-1-of-2">

                        <div slot="heading" translate>
                            Vehicle group
                        </div>

                        <item repeat.for="vehicleGroup of model.vehicleGroups" model.bind="vehicleGroup">
                            ${vehicleGroup.name}
                        </item>

                        <div slot="validation">

                            <required-validator
                                value.bind="selectedVehicleGroup">
                            </required-validator>

                        </div>

                    </select-input>

                    <number-input
                        label="above"
                        value.bind="model.scenario.gates[0].slots[0].timeBetweenDepartures | scale: 1/60"
                        min.bind="0"
                        constrain.bind="true"
                        class="flex-basis-1-of-2">

                        <div slot="heading" translate>
                            Interval
                        </div>

                        <span slot="after" class="opacity-faded" translate>
                            min
                        </span>

                        <div slot="validation">

                            <required-validator
                                value.bind="model.scenario.gates[0].slots[0].timeBetweenDepartures">
                            </required-validator>

                            <range-validator
                                active.bind="true"
                                value.bind="model.scenario.gates[0].slots[0].timeBetweenDepartures"
                                min.bind="0"
                                min-inclusive.bind="false">
                            </range-validator>

                        </div>

                    </number-input>

                </div>

                <div class="control-row margin-large-bottom">

                    <date-input
                        class="flex-basis-1-of-2"
                        label="above"
                        value.bind="model.scenario.criteria.datePeriod.from"
                        max.bind="model.scenario.criteria.datePeriod.to">

                        <div slot="heading" translate>
                            From date
                        </div>

                        <div slot="validation">

                            <range-validator
                                active.bind="true"
                                value.bind="model.scenario.criteria.datePeriod.from"
                                max.bind="model.scenario.criteria.datePeriod.to"
                                max-inclusive.bind="false">

                                <template replace-part="invalid-max" translate>
                                    Please choose a time before the to time.
                                </template>

                            </range-validator>

                        </div>

                    </date-input>

                    <date-input
                        class="flex-basis-1-of-2"
                        label="above"
                        value.bind="model.scenario.criteria.datePeriod.to"
                        min.bind="model.scenario.criteria.datePeriod.from">

                        <div slot="heading" translate>
                            To date
                        </div>

                        <div slot="validation">

                            <range-validator
                                active.bind="true"
                                value.bind="model.scenario.criteria.datePeriod.to"
                                min.bind="model.scenario.criteria.datePeriod.from"
                                min-inclusive.bind="false">

                                <template replace-part="invalid-min" translate>
                                    Please choose a time after the from time.
                                </template>

                            </range-validator>

                        </div>

                    </date-input>

                </div>

                <div class="control-row margin-large-bottom">

                    <time-input
                        label="above"
                        value.bind="selectedEarliestArrival"
                        class="flex-basis-1-of-2"
                        max.bind="selectedLatestDeparture">

                        <div slot="heading" translate>
                            Earliest arrival
                        </div>

                        <div slot="validation">

                            <required-validator
                                value.bind="selectedEarliestArrival">
                            </required-validator>

                            <range-validator
                                active.bind="true"
                                value.bind="selectedEarliestArrival"
                                max.bind="selectedLatestDeparture"
                                max-inclusive.bind="false">

                                <template replace-part="invalid-max" translate>
                                    Please choose a time before the latest departure time.
                                </template>

                            </range-validator>

                        </div>

                    </time-input>

                    <time-input
                        label="above"
                        value.bind="selectedLatestDeparture"
                        class="flex-basis-1-of-2"
                        min.bind="selectedEarliestArrival">

                        <div slot="heading" translate>
                            Latest departure
                        </div>

                        <div slot="validation">

                            <required-validator
                                value.bind="selectedLatestDeparture">
                            </required-validator>

                            <range-validator
                                active.bind="true"
                                value.bind="selectedLatestDeparture"
                                min.bind="selectedEarliestArrival"
                                min-inclusive.bind="false">

                                <template replace-part="invalid-min" translate>
                                    Please choose a time after the earliest arrival time.
                                </template>

                            </range-validator>

                        </div>

                    </time-input>

                </div>

                <div class="control-row">

                    <tags-input
                        label="above"
                        value.bind="model.scenario.criteria.weekdays"
                        filter="auto"
                        class="flex-basis-1-of-1">

                        <div slot="heading" translate>
                            Weekdays
                        </div>

                        <div slot="value">
                            <tag repeat.for="weekday of model.scenario.criteria.weekdays" model.bind="weekday">
                                ${weekday | weekday}
                            </tag>
                        </div>

                        <item repeat.for="weekday of 7" model.bind="weekday + 1">
                            ${weekday + 1 | weekday}
                        </item>

                        <div slot="validation">

                            <required-validator
                                value.bind="model.scenario.criteria.weekdays.length > 0 ? true : undefined">
                            </required-validator>

                        </div>

                    </tags-input>

                </div>

            </modal-section>

            <div if.bind="isNew" class="button-container margin-larger-top">

                <button class="margin-large-left" appearance="solid" accent="primary" click.trigger="onSaveClick()" translate>
                    Create reservation
                </button>

            </div>

        </template>

    </modal-panel>

</template>
