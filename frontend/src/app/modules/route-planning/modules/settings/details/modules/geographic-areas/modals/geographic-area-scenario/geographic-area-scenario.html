<template>

    <require from="app/components/separator/separator"></require>
    <require from="app/components/address-input/address-input"></require>

    <require from="./geographic-area-scenario.scss"></require>

    <modal-backdrop close="all"></modal-backdrop>

    <modal-panel name="geographic-area-scenario" position="right" close-button.bind="true" close-shortcut.bind="true" scroll validation validation.ref="validation">

        <div slot="actions">

            <button
                if.bind="!isNew"
                appearance="icon"
                title.translate="Save changes"
                click.trigger="onSaveClick()">
                <icon name="save"></icon>
            </button>

        </div>

        <modal-header scroll-fade>

            <h1 class="font-largest" tabindex="-1" autofocus="visible.bind: false">

                <template if.bind="isNew" translate>
                    New area rule
                </template>

                <template if.bind="!isNew" translate>
                    Edit area rule
                </template>

            </h1>

        </modal-header>

        <modal-section>

            <div slot="header" translate>
                Period and weekdays
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify which period and which rules should apply.
            </h1>

            <div class="control-row">

                <date-input label="above" value.bind="model.criteria.datePeriod.from" max.bind="model.criteria.datePeriod.to" class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        From date
                    </div>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.criteria.datePeriod.from">
                        </required-validator>

                        <range-validator
                            value.bind="model.criteria.datePeriod.from"
                            max.bind="model.criteria.datePeriod.to"
                            max-inclusive.bind="false">

                            <template replace-part="invalid-max" translate>
                                Please choose a time before the to time.
                            </template>

                        </range-validator>

                    </div>

                </date-input>

                <date-input label="above" value.bind="model.criteria.datePeriod.to" min.bind="model.criteria.datePeriod.from" class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        To date
                    </div>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.criteria.datePeriod.to">
                        </required-validator>

                        <range-validator
                            value.bind="model.criteria.datePeriod.to"
                            min.bind="model.criteria.datePeriod.from"
                            min-inclusive.bind="false">

                            <template replace-part="invalid-min" translate>
                                Please choose a time after the from time.
                            </template>

                        </range-validator>

                    </div>

                </date-input>

            </div>

            <div class="control-row margin-large-top">

                <tags-input
                    label="above"
                    value.bind="model.criteria.weekdays"
                    filter="auto"
                    class="flex-basis-1-of-1">

                    <div slot="heading">
                        <span slot="heading" translate>
                            Weekdays
                        </span>
                        <info-icon position="right">
                            <div slot="body" translate>
                                If both date range & weekdays are specified, the rule will only apply to the weekdays in the specified date range
                            </div>
                        </info-icon>
                    </div>

                    <div slot="value">
                        <tag repeat.for="weekday of model.criteria.weekdays" model.bind="weekday">
                            ${weekday | weekday}
                        </tag>
                    </div>

                    <item repeat.for="weekday of 7" model.bind="weekday + 1">
                        ${weekday + 1 | weekday}
                    </item>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.criteria.weekdays.length > 0 ? true : undefined">
                        </required-validator>

                    </div>

                </tags-input>

            </div>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Order tags
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify the order tags that must be matched for the rule to apply.
            </h1>

            <tags-input
                label="above"
                value.bind="model.criteria.orderTagsAllRequired"
                new.bind="true"
                class="flex-basis-1-of-1">

                <div slot="heading">
                    <span slot="heading" translate>
                        Order must have all the following tags
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            The order may have multiple tags, but must at least contain all the tags listed in the list below
                        </div>
                    </info-icon>
                </div>

                <div slot="value">
                    <tag model.bind="tag" repeat.for="tag of model.criteria.orderTagsAllRequired">
                        ${tag}
                    </tag>
                </div>

            </tags-input>

            <separator class="margin-larger-top margin-large-bottom">
                <span class="opacity-faded" translate>
                    or
                </span>
            </separator>

            <tags-input
                label="above"
                value.bind="model.criteria.orderTagsOneRequired"
                new.bind="true"
                class="flex-basis-1-of-1">

                <div slot="heading">
                    <span slot="heading" translate>
                        Order must have at least one of the following tags
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            The order may have multiple tags, but must contain at least one of the tags listed in the list below
                        </div>
                    </info-icon>
                </div>

                <div slot="value">
                    <tag model.bind="tag" repeat.for="tag of model.criteria.orderTagsOneRequired">
                        ${tag}
                    </tag>
                </div>

            </tags-input>

        </modal-section>

        <modal-section class="--line-above">

            <div slot="header" translate>
                Limitations
            </div>

            <h1 class="margin-large-bottom" translate>
                Here you can specify the adjustments to apply within the area, or mark the area as blocked.
            </h1>

            <div class="control-row margin-medium-bottom">

                <number-input value.bind="model.taskTimeChange | scale: 1/60" disabled.bind="model.isAreaBlocked" label="above" class="flex-basis-1-of-2">

                    <div slot="heading">
                        <span slot="heading" translate>
                            Task time change
                        </span>
                        <info-icon position="right">
                            <div slot="body" translate>
                                If it takes longer to do the actual loading and unloading in the geographic area. It is also possible to indicate negative time
                            </div>
                        </info-icon>
                    </div>

                    <span slot="after" class="opacity-faded" translate>
                        min
                    </span>

                    <div slot="validation">

                        <required-validator
                            enabled.bind="!model.isAreaBlocked"
                            value.bind="model.taskTimeChange">
                        </required-validator>

                    </div>

                </number-input>

                <number-input value.bind="model.drivingTimeChangeFactor | scale: 100" disabled.bind="model.isAreaBlocked" label="above" class="flex-basis-1-of-2">

                    <div slot="heading">
                        <span slot="heading" translate>
                            Driving time change
                        </span>
                        <info-icon position="left">
                            <div slot="body" translate>
                                If a driving time is calculated at 10 minutes on a stretch, this will be 11 minutes if set to 10% within this geographic area. This value can be negative.
                            </div>
                        </info-icon>
                    </div>

                    <span slot="after" class="opacity-faded" translate>
                        %
                    </span>

                    <div slot="validation">

                        <required-validator
                            enabled.bind="!model.isAreaBlocked"
                            value.bind="model.drivingTimeChangeFactor">
                        </required-validator>

                    </div>

                </number-input>

            </div>

            <check-toggle label="after" value.bind="model.isAreaBlocked">

                <div slot="heading">
                    <span slot="heading" translate>
                        Area is blocked
                    </span>
                    <info-icon position="right">
                        <div slot="body" translate>
                            It will not be possible to make deliveries in this area
                        </div>
                    </info-icon>
                </div>

            </check-toggle>

        </modal-section>

        <div if.bind="isNew" class="button-container margin-larger-top">

            <button appearance="solid" accent="primary" click.trigger="onSaveClick()">
                <span slot="heading" translate>
                    Create area rule
                </span>
                <info-icon position="right">
                    <div slot="body" translate>
                        It will not be possible to make deliveries in this area
                    </div>
                </info-icon>
            </button>

        </div>

    </modal-panel>

</template>
