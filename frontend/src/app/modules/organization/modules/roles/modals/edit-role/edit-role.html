<template>

    <require from="app/components/star-icon/star-icon"></require>
    <require from="app/components/address-input/address-input"></require>
    <require from="./components/permissions/permissions"></require>
    <require from="./edit-role.scss"></require>

    <modal-backdrop close="all"></modal-backdrop>

    <modal-panel name="edit-role" position="right" close-button.bind="true" close-shortcut.bind="true" scroll validation validation.ref="validation">

        <div slot="actions">

            <button
                if.bind="!role.readonly && role.id"
                disabled.bind="availablePermissions == null"
                appearance="icon"
                title.translate="Save changes"
                click.trigger="onSubmitClick()">
                <icon name="save"></icon>
            </button>

        </div>

        <modal-header scroll-fade>

            <h1 class="font-largest margin-bottom" tabindex="-1" autofocus="visible.bind: false">

                <span if.bind="!role.id" translate>
                    New role
                </span>

                <template if.bind="role.id">
                    <span translate>
                        Edit role
                    </span>
                    <star-icon entity.bind="role"></star-icon>
                </template>

            </h1>

            <h2 class="font-large" translate>
                Please specify the name and permissions for the role.
            </h2>

        </modal-header>

        <modal-section class="margin-double-bottom">

            <text-input value.bind="role.name" label="above" class="flex-basis-1-of-1" readonly.bind="role.readonly">

                <div slot="heading" translate>
                    Name
                </div>

                <div slot="validation">

                    <required-validator
                        value.bind="role.name">
                    </required-validator>

                    <unique-validator
                        new-value.bind="role.name"
                        old-value.bind="roleName"
                        all-values.bind="roles | map: 'name'">
                    </unique-validator>

                </div>

            </text-input>

            <div class="input margin-double-top margin-half-bottom" label="above">
                <label class="input-label">
                    <div class="input-heading" translate>
                        Permissions
                    </div>
                </label>
            </div>

            <permissions permissions.bind="availablePermissions" value.bind="role.permissions" readonly.bind="role.readonly"></permissions>

            <busy-indicator if.bind="availablePermissions == null" animate.bind="false"></busy-indicator>

        </modal-section>

        <button if.bind="!role.id && availablePermissions != null" appearance="solid" accent="primary" click.delegate="onSubmitClick()" translate>
            Create role
        </button>

    </modal-panel>

</template>
