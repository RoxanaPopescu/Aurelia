<template>
    <require from="./create-multiple.scss"></require>
    <page name="create-multiple">

        <page-content scroll scroll.ref="scroll" validation validation.ref="validation">
            <page-header class="flex-row" scroll-fade>
                <h1 class="font-largest">
                    <path-nav>

                        <a accent="inherit" href="/fleet-management/drivers" translate>
                            Drivers
                        </a>

                        <span translate>
                            Create multiple
                        </span>
                    </path-nav>
                </h1>

            </page-header>

            <page-section class="driver-section">
                <div class="control-row margin-bottom">
                    <text-input label="above" value.bind="driver.name.first" class="flex-basis-1-of-2">

                        <div slot="heading" translate>
                            First name
                        </div>

                        <div slot="validation">

                            <required-validator
                                value.bind="driver.name.first">
                            </required-validator>

                        </div>

                    </text-input>

                    <text-input label="above" value.bind="driver.name.last" class="flex-basis-1-of-2">

                        <div slot="heading" translate>
                            Last name
                        </div>

                        <div slot="validation">

                            <required-validator
                                value.bind="driver.name.last">
                            </required-validator>

                        </div>

                    </text-input>
                </div>

                <div class="control-row margin-bottom">
                    <email-input label="above" value.bind="driver.email" class="flex-basis-1-of-1">

                        <div slot="heading" translate>
                            Email
                        </div>

                        <div slot="validation">

                            <required-validator
                                value.bind="driver.email">
                            </required-validator>

                            <invalid-validator if.bind="emailOrPhoneAlreadyExist">

                                <template replace-part="invalid" translate>
                                    The email or phone number already exist
                                </template>

                            </invalid-validator>

                        </div>

                    </email-input>
                </div>

                <div class="control-row margin-bottom">
                    <text-input maxlength="3" label="above" value.bind="driver.phone.countryPrefix" style="width: 100rem;">
                        <div slot="heading" translate>
                            Country code
                        </div>

                        <div slot="validation">

                            <required-validator
                                value.bind="driver.phone.countryPrefix">
                            </required-validator>

                            <length-validator
                                value.bind="driver.phone.countryPrefix"
                                max.bind="3"
                                min.bind="2">
                            </length-validator>

                            <pattern-validator
                                active.bind="true"
                                value.bind="driver.phone.countryPrefix"
                                pattern="^[0-9]*$">

                                <template replace-part="invalid" translate>
                                    Please only provide a value with numbers.
                                </template>

                            </pattern-validator>
                        </div>
                    </text-input>
                    <text-input label="above" value.bind="driver.phone.number" class="flex-grow">
                        <div slot="heading" translate>
                            Phone number
                        </div>

                        <div slot="validation">

                            <required-validator
                                value.bind="driver.phone.number">
                            </required-validator>

                            <length-validator
                                value.bind="driver.phone.number"
                                min.bind="6">
                            </length-validator>

                            <invalid-validator if.bind="emailOrPhoneAlreadyExist">
                                <template replace-part="invalid" translate>
                                    The email or phone number already exist
                                </template>
                            </invalid-validator>
                        </div>
                    </text-input>
                </div>

                <div if.bind="isNew" class="control-row margin-bottom">
                    <text-input label="above" value.bind="driver.password" class="flex-basis-1-of-1">
                        <div slot="heading" translate>
                            Password
                        </div>

                        <div if.bind="driver.password" slot="validation">
                            <required-validator
                                value.bind="driver.password">
                            </required-validator>
                            <length-validator
                                value.bind="driver.password"
                                min.bind="6">
                            </length-validator>
                        </div>
                    </text-input>
                </div>

                <div class="control-row margin-larger-bottom">
                    <select-input label="above" none.bind="false" value.bind="driver.status" display-value.bind="driver.status.name" class="flex-basis-1-of-1">

                        <div slot="heading" translate>
                            Status
                        </div>

                        <item repeat.for="status of statuses" model.bind="status">
                            ${status.name}
                        </item>

                        <div slot="validation">

                            <required-validator
                                value.bind="driver.status">
                            </required-validator>

                        </div>

                    </select-input>
                </div>

                <button appearance="solid" accent="primary" click.trigger="onCreateClick()" translate>
                    Create drivers
                </button>
            </page-section>

            <page-section class="--line-above">
                <h1 class="font-largest margin-bottom" tabindex="-1" autofocus="visible.bind: false" translate>
                    Results
                </h1>

                <div if.bind="results.length < 1" class="margin-large-bottom" translate>
                    No results, when added they will show up here.
                </div>

                <div repeat.for="result of results" model.bind="result" class="margin-smaller-bottom">

                    <div translate>
                        ${result.created | time: 'narrow' : false}
                    </div>

                    <div if.bind="result.failed == 'no' && !result.driver.id" translate>
                        Creating ${result.driver.name}...
                    </div>

                    <div if.bind="result.failed != 'no'">
                        <span translate>
                            Failed to add with problem: ${result.failed}
                        </span>
                        <a click.trigger="onTransferClick(result.driver)" translate>
                            (transfer to form)
                        </a>
                    </div>

                    <div if.bind="result.driver.id">
                        <span translate>
                            Created
                        </span>
                        <a target="_blank" href="/fleet-management/drivers/details/${result.driver.id}">
                            ${result.driver.name} (${result.driver.id})
                        </a>
                    </div>
                </div>

            </page-section>
        </page-content>
    </page>
</template>
