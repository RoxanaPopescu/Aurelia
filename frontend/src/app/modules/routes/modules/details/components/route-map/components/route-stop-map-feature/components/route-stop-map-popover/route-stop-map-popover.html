<template ref="element">

    <require from="shared/google-maps/components/google-map/google-map-popover.scss" as="scoped"></require>

    <require from="app/components/name-value-pair/name-value-pair"></require>
    <require from="app/components/name-value-pair/name-value-pair.scss" as="scoped"></require>

    <require from="./route-stop-map-popover.scss" as="scoped"></require>

    <!-- HACK: The `if.bind="true"`here is required to prevent a templating bug. -->
    <google-map-popover
        if.bind="true"
        content.bind="element"
        offset-y.bind="-16">

        <h1 translate>
            Stop ${routeStop.stopNumber | number}
        </h1>

        <p if.bind="routeStop.outfit.primaryName" class="user-select-text">
            ${routeStop.outfit.primaryName}
            <br if.bind="routeStop.outfit.primaryName && routeStop.outfit.secondaryName">
            ${routeStop.outfit.secondaryName}
        </p>

        <p if.bind="routeStop.outfit.primaryName" class="user-select-text">
            ${routeStop.location.address.primary}
            <br if.bind="routeStop.location.address.primary && routeStop.location.address.secondary">
            ${routeStop.location.address.secondary}
        </p>

        <name-value-pair class="margin-top">

            <div slot="name" translate>
                Type
            </div>

            <div slot="value">
                ${routeStop.type.name}
            </div>

        </name-value-pair>

        <name-value-pair class="margin-top">

            <div slot="name" translate>
                Status
            </div>

            <div slot="value" accent.bind="routeStop.status.accent & attr">
                ${routeStop.status.name}
            </div>

        </name-value-pair>

        <p if.bind="routeStop.isDelayed" accent="negative">
            <template if.bind="routeStop.arrivalDelay" translate>
                Delayed ${routeStop.arrivalDelay | duration}
            </template>
            <template else translate>
                Delayed
            </template>
        </p>

        <p if.bind="routeStop.deviations.length > 0" accent="negative" translate>
            ${routeStop.deviations.length | number} ${routeStop.deviations.length | plural: "deviation" : "deviations"}
        </p>

        <hr class="hr-line margin">

        <h2 translate>
            Timing
        </h2>

        <template if.bind="routeStop.arrivalTimeFrame">

            <name-value-pair class="margin-top">

                <div slot="name" translate>
                    Time frame
                </div>

                <div slot="value">
                    ${routeStop.arrivalTimeFrame | timeRange: false}
                </div>

            </name-value-pair>

        </template>

        <template if.bind="routeStop.arrivedTime">

            <name-value-pair class="margin-top">

                <div slot="name" translate>
                    Arrived time
                </div>

                <div slot="value">
                    ${routeStop.arrivedTime | time: 'narrow' : false}
                </div>

            </name-value-pair>

        </template>

        <template if.bind="routeStop.arrivedTime == null && routeStop.estimates.arrivalTime">

            <name-value-pair class="margin-top">

                <div slot="name" translate>
                    Estimated arrival time
                </div>

                <div slot="value">
                    ${routeStop.estimates.arrivalTime | time: 'narrow' : false}
                </div>

            </name-value-pair>

        </template>

        <template if.bind="routeStop.taskTime">

            <name-value-pair class="margin-top">

                <div slot="name" translate>
                    Task time
                </div>

                <div slot="value">
                    ${routeStop.taskTime | duration}
                </div>

            </name-value-pair>

        </template>

        <template if.bind="routeStop.taskTime == null && routeStop.estimates.taskTime">

            <name-value-pair class="margin-top">

                <div slot="name" translate>
                    Estimated task time
                </div>

                <div slot="value">
                    ${routeStop.estimates.taskTime | duration}
                </div>

            </name-value-pair>

        </template>

        <template if.bind="routeStop.waitingTime">

            <name-value-pair class="margin-top">

                <div slot="name" translate>
                    Waiting time
                </div>

                <div slot="value">
                    ${routeStop.waitingTime | duration}
                </div>

            </name-value-pair>

        </template>

        <template if.bind="routeStop.waitingTime == null && routeStop.estimates.waitingTime">

            <name-value-pair class="margin-top">

                <div slot="name" translate>
                    Estimated waiting time
                </div>

                <div slot="value">
                    ${routeStop.estimates.waitingTime | duration}
                </div>

            </name-value-pair>

        </template>

        <template if.bind="routeStop.driverInstructions">

            <hr class="hr-line margin">

            <h2 translate>
                Driver instructions
            </h2>

            <p>
                ${routeStop.driverInstructions}
            </p>

        </template>

    </google-map-popover>

</template>
