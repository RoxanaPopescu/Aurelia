<template>

    <require from="app/components/address-input/address-input"></require>
    <require from="app/components/info-icon/info-icon"></require>
    <require from="./details.scss"></require>

    <modal-backdrop close="all"></modal-backdrop>

    <modal-panel name="details" position="right" close-button.bind="true" close-shortcut.bind="true" scroll validation validation.ref="validation">

        <modal-header scroll-fade>

            <h1 class="font-largest" tabindex="-1" autofocus="visible.bind: false">

                <span if.bind="!model.id" translate>
                    New schedule
                </span>

                <span if.bind="model.id" translate>
                    Edit schedule
                </span>

            </h1>

        </modal-header>

        <modal-section class="margin-bottom">

            <h2 class="font-larger margin-bottom" translate>
                Execution
            </h2>

            <div class="control-row margin-medium-bottom">

                <select-input
                    label="above"
                    value.bind="executeDayOfWeek"
                    display-value.bind="executeDayOfWeek | weekday | case: 'sentence'"
                    none.bind="false"
                    filter="auto"
                    class="flex-basis-1-of-2"
                    fixed.bind="true">

                    <div slot="heading" translate>
                        Day of week
                    </div>

                    <item repeat.for="dayOfWeek of [1, 2, 3, 4, 5, 6, 7]" model.bind="dayOfWeek">
                        ${dayOfWeek | weekday | case: 'sentence'}
                    </item>

                    <div slot="validation">

                        <required-validator
                            value.bind="executeDayOfWeek">
                        </required-validator>

                    </div>

                </select-input>

                <time-input
                    label="above"
                    value.bind="executeTime"
                    none.bind="false"
                    max-inclusive.bind="false"
                    class="flex-basis-1-of-2"
                    fixed.bind="true">

                    <div slot="heading" translate>
                        Time
                    </div>

                    <div slot="validation">

                        <required-validator
                            value.bind="executeTime">
                        </required-validator>

                    </div>

                </time-input>

            </div>

            <div class="control-row margin-larger-bottom">

                <date-time-input label="above" value.bind="model.nextExecution" class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Next execution
                    </div>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.nextExecution">
                        </required-validator>

                    </div>

                </date-time-input>

                <select-input
                    label="above"
                    value.bind="timeZone"
                    none.bind="false"
                    filter="auto"
                    class="flex-basis-1-of-2"
                    fixed.bind="true">

                    <div slot="heading" translate>
                        TimeZone
                    </div>

                    <item model="Europe/Copenhagen">
                        Europe/Copenhagen
                    </item>

                    <item model="Europe/Oslo">
                        Europe/Oslo
                    </item>

                    <item model="Europe/Stockholm">
                        Europe/Stockholm
                    </item>

                    <item model="Europe/Berlin">
                        Europe/Berlin
                    </item>

                    <item model="Europe/London">
                        Europe/London
                    </item>

                    <div slot="validation">

                        <required-validator
                            value.bind="timeZone">
                        </required-validator>

                    </div>

                </select-input>

            </div>

            <hr class="hr-line margin-larger-bottom">

            <h2 class="font-larger margin-bottom" tabindex="-1" autofocus="visible.bind: false" translate>
                Route
            </h2>

            <div class="margin-large-bottom" translate>
                The specific time of the days is defined in the stops, if you create a route for Monday that would mean Monday 12:00 if the first stop has this time.
            </div>

            <div class="control-row margin-large-bottom">

                <select-input
                    label="above"
                    value.bind="model.routeDayOfWeek"
                    display-value.bind="model.routeDayOfWeek | weekday | case: 'sentence'"
                    none.bind="false"
                    filter="auto"
                    class="flex-basis-1-of-2"
                    fixed.bind="true">

                    <div slot="heading" translate>
                        Day of week
                    </div>

                    <item repeat.for="dayOfWeek of [1, 2, 3, 4, 5, 6, 7]" model.bind="dayOfWeek">
                        ${dayOfWeek | weekday | case: 'sentence'}
                    </item>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.routeDayOfWeek">
                        </required-validator>

                    </div>

                </select-input>

                <select-input label="above" none.bind="false" value.bind="model.routeStatus" display-value.bind="model.routeStatus.name" class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Status
                    </div>

                    <item repeat.for="status of statuses" model.bind="status">
                        ${status.name}
                    </item>

                    <div slot="validation">

                        <required-validator
                            value.bind="model.routeStatus">
                        </required-validator>

                    </div>

                </select-input>

            </div>

            <div class="control-row margin-large-bottom">

                <text-input readonly.bind="true" value.to-view="driver" label="above" class="flex-basis-1-of-1">

                    <div slot="heading" translate>
                        Driver
                    </div>

                    <div slot="placeholder" translate>
                        No driver selected
                    </div>

                    <div slot="after">
                        <button if.bind="driver" class="margin-right-large margin-left-large" appearance="none" accent="primary" click.trigger="onRemoveDriverClick()">
                            <icon name="ico-close"></icon>
                        </button>
                        <button appearance="solid" accent="secondary" click.delegate="onAssignDriverClick()">
                            <template if.bind="!driver" translate>
                                Assign driver
                            </template>
                            <template if.bind="driver" translate>
                                Reassign
                            </template>
                        </button>
                    </div>

                </text-input>

            </div>

            <hr class="hr-line margin-large-bottom">

            <h2 class="font-larger margin-bottom" tabindex="-1" autofocus="visible.bind: false" translate>
                Limitations
            </h2>

            <div class="margin-large-bottom" translate>
                The schedule can be limited to inbetween two dates, if these are not set the schedule will always be active.
            </div>

            <div class="control-row margin-large-bottom">

                <date-time-input label="above" value.bind="model.activeDateTimeRange.from" class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Enabled from
                    </div>

                </date-time-input>

                <date-time-input label="above" value.bind="model.activeDateTimeRange.to" class="flex-basis-1-of-2">

                    <div slot="heading" translate>
                        Enabled to
                    </div>

                </date-time-input>

            </div>

            <div class="control-row">

                <check-toggle
                    label="after"
                    value.bind="model.paused"
                    class="flex-basis-1-of-2">
                    <div slot="heading" translate>
                        Paused
                    </div>

                </check-toggle>

            </div>

        </modal-section>


        <button appearance="solid" accent="primary" class="margin-larger-top" click.delegate="onCreateClick()">
            <span translate if.bind="!model.id">
                Create schedule
            </span>
            <span translate if.bind="model.id">
                Update schedule
            </span>
        </button>

    </modal-panel>

</template>
