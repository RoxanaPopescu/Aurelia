<template>

    <require from="app/components/separator/separator"></require>
    <require from="./generate-test-routes.scss"></require>

    <page name="generate-test-routes">

        <page-content scroll scroll.ref="scroll" validation validation.ref="validation">

            <page-header scroll-fade>

                <h1 class="font-largest">
                    <path-nav>

                        <a accent="inherit" href="/routes" translate>
                            Routes
                        </a>

                        <span translate>
                            Generate test routes
                        </span>

                    </path-nav>
                </h1>

            </page-header>

            <page-section>

                <div class="flex-row">

                    <div class="flex-basis-1-of-2 margin-large-right">

                        <div class="margin-large-bottom" translate>
                            You can generate a route from either a template or directly to a requestId.
                        </div>

                        <select-input
                            label="above"
                            none.bind="false"
                            value.bind="selectedTemplate"
                            display-value.bind="selectedTemplate.name"
                            class="margin-large-bottom">

                            <div slot="heading" translate>
                                Template to copy from
                            </div>

                            <div slot="placeholder" translate>
                                Select template
                            </div>

                            <item repeat.for="template of availableTemplates" model.bind="template">
                                <div accent="primary">
                                    ${template.name}
                                </div>
                                <div class="font-small margin-smallest-top opacity-faded" translate>
                                    ${template.description}
                                </div>
                            </item>

                            <div if.bind="!template && !requestId" slot="validation">

                                <required-validator
                                    value.bind="template">
                                </required-validator>

                            </div>

                        </select-input>

                        <separator class="margin-larger-top margin-large-bottom">
                            <span class="opacity-faded" translate>
                                or
                            </span>
                        </separator>

                        <text-input class="margin-large-bottom" label="above" value.bind="requestId">

                            <div slot="heading">
                                Request id
                            </div>

                            <div if.bind="!template && !requestId" slot="validation">

                                <required-validator
                                    value.bind="requestId"
                                >
                                </required-validator>

                            </div>

                        </text-input>
                    </div>
                </div>
            </page-section>

            <page-section class="--line-above">
                <div class="flex-row">
                    <div class="flex-basis-1-of-2 margin-large-right">
                        <div slot="header" class="margin-large-bottom" translate>
                            General
                        </div>

                        <div class="flex-row margin-large-bottom">
                            <date-input
                                class="flex-basis-2-of-3 margin-right"
                                label="above"
                                value.bind="date">

                                <div slot="heading" translate>
                                    Start date
                                </div>

                                <div if.bind="time" slot="validation">

                                    <required-validator
                                        value.bind="date">
                                    </required-validator>

                                </div>

                            </date-input>
                            <time-input label="above" value.bind="time" class="flex-basis-1-of-3">

                                <div slot="heading" translate>
                                    start time
                                </div>

                                <div if.bind="date" slot="validation">

                                    <required-validator
                                        value.bind="time">
                                    </required-validator>

                                </div>

                            </time-input>
                        </div>

                        <div class="flex-row margin-large-bottom">
                            <text-input readonly="true" class="flex-basis-2-of-3 margin-right" label="above" value.bind="driver.name">

                                <div slot="heading" translate>
                                    Assign to driver (not required)
                                </div>

                                <div slot="placeholder" translate>
                                    No driver selected
                                </div>

                            </text-input>

                            <button class="flex-basis-1-of-3 create-driver-button" disabled.bind="updating" appearance="outline" accent="primary" click.trigger="onSelectDriver()">
                                Select
                            </button>

                        </div>

                        <button appearance="solid" accent="primary" click.trigger="onGenerate()">
                            Generate
                        </button>
                    </div>
                </div>

            </page-section>

            <page-section class="--line-above">
                <div slot="header" translate>
                    Results
                </div>

                <div if.bind="results.length < 1" class="margin-large-bottom" translate>
                    No results - when they are created they will show their status here.
                </div>

                <div repeat.for="result of results" model.bind="result" class="margin-smaller-bottom">

                    <div>
                        ${result.created | time: 'narrow' : false}
                    </div>

                    <div if.bind="!result.slug && !result.failed">
                        Generating ${result.name}...
                    </div>

                    <div if.bind="result.failed">
                        Failed to add ${result.name}
                    </div>

                    <div if.bind="result.slug">
                         Generated
                         <a target="_blank" href="/routes/details/${result.slug}">
                            ${result.slug}
                        </a>
                         from ${result.name}
                    </div>
                </div>

            </page-section>
        </page-content>
    </page>

</template>
