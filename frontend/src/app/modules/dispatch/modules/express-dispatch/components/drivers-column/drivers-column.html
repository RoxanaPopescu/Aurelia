<template>

    <require from="./drivers-column.scss"></require>

    <page-content scroll scroll.ref="scroll">

        <page-header scroll-fade>

            <div class="flex-row">

                <toolbar if-claims="edit-routes">

                    <button
                        appearance="solid"
                        accent="primary"
                        disabled.bind="workspace.selectedDriverRoutes.length != 1"
                        click.trigger="onMergeClick()">
                        <span if.bind="workspace.selectedExpressRoutes.length == 0" translate>
                            Modify selected driver route
                        </span>
                        <span if.bind="workspace.selectedExpressRoutes.length > 0" translate>
                            Add selected routes to driver route
                        </span>
                    </button>

                    <button
                        appearance="outline"
                        accent="primary"
                        disabled.bind="workspace.selectedExpressRoutes.length == 0"
                        click.trigger="onReleaseClick()"
                        translate>
                        Release selected routes to all drivers
                    </button>

                    <button
                        appearance="outline"
                        accent="primary"
                        disabled.bind="workspace.selectedExpressRoutes.length == 0 || workspace.selectedDriverRoutes.length == 0"
                        click.trigger="onStartAutomaticDispatch()"
                        translate>
                        Start automatic dispatch
                    </button>

                </toolbar>

                <h1 class="font-largest">
                    <path-nav>

                        <span>&nbsp;</span>

                    </path-nav>
                </h1>

            </div>

        </page-header>

        <page-section>

            <h2 class="font-larger margin-larger-bottom" translate>
                Drivers on contract
            </h2>

            <toolbar class="margin-larger-bottom" scroll-fade="0.2">

                <search-input value.bind="textFilter & debounce: 200">

                    <div slot="placeholder">
                        Filterâ€¦
                    </div>

                </search-input>

            </toolbar>

            <data-table
                appearance="rows"
                selection="multiple"
                toggle-all.call="onToogleAll(value)">

                <data-table-headers>

                    <data-table-cell title.translate="Vehicle">
                        <span class="text-truncate" translate>
                            Vehicle
                        </span>
                    </data-table-cell>

                    <data-table-cell title.translate="Online">
                        <span class="text-truncate" translate>
                            Available
                        </span>
                    </data-table-cell>

                    <data-table-cell title.translate="Online">
                        <span class="text-truncate" translate>
                            Online/Offline
                        </span>
                    </data-table-cell>

                    <data-table-cell title.translate="Name">
                        <span class="text-truncate" translate>
                            Name
                        </span>
                    </data-table-cell>

                    <data-table-cell title.translate="Name">
                        <span class="text-truncate" translate>
                            Phone
                        </span>
                    </data-table-cell>

                    <data-table-cell title.translate="Done">
                        <span class="text-truncate" translate>
                            Done
                        </span>
                    </data-table-cell>

                    <data-table-cell title.translate="Next stop">
                        <span class="text-truncate" translate>
                            Next stop
                        </span>
                    </data-table-cell>

                    <data-table-cell>
                        <span class="text-truncate" translate>
                            Details
                        </span>
                    </data-table-cell>

                </data-table-headers>

                <template repeat.for="item of orderedAndFilteredItems">

                    <data-table-row accent.bind="item.selected ? 'neutral' : undefined" selected.bind="item.selected" toggle.call="onRowToggle(item, value)">

                        <data-table-cell title.bind="item.vehicle.vehicleType.name">
                            <span class="text-truncate">
                                ${item.vehicle.type.name}
                            </span>
                        </data-table-cell>

                        <data-table-cell title.bind="item.available">
                            <span class="text-truncate">
                                <template if.bind="item.available" translate>
                                    Yes
                                </template>
                                <template if.bind="!item.available" translate>
                                    No
                                </template>
                            </span>
                        </data-table-cell>

                        <data-table-cell title.bind="item.slug" accent.bind="!item.driverOnline ? 'negative' : 'neutral' & attr">
                            <icon name="md-warning" if.bind="!item.driverOnline"></icon>
                            <span class="text-truncate">
                                <template if.bind="item.driverOnline" translate>
                                    Online
                                </template>
                                <template if.bind="!item.driverOnline" translate>
                                    Offline
                                </template>
                            </span>
                        </data-table-cell>

                        <data-table-cell title.bind="item.driver.name">

                            <a class="text-truncate" href="/fleet-management/drivers/details/${item.driver.id}">
                                ${item.driver.name}
                            </a>
                        </data-table-cell>

                        <data-table-cell title.bind="item.driver.phone">

                            <a class="text-truncate" href="tel:${item.driver.phone}">
                                ${item.driver.phone}
                            </a>
                        </data-table-cell>

                        <data-table-cell title.bind="item.completionTime | time: 'narrow' : false">
                            <span class="text-truncate">
                                ${item.completionTime | time: 'narrow' : false}
                            </span>
                        </data-table-cell>

                        <data-table-cell title.bind="item.nextStop.location.address">
                            <span class="text-truncate">
                                ${item.nextStop.location.address}
                            </span>
                        </data-table-cell>

                        <data-table-cell title.bind="route.slug">
                            <a href="/routes/details/${item.slug}" class="text-truncate" translate>
                                Details
                            </a>
                        </data-table-cell>


                    </data-table-row>

                </template>

            </data-table>

            <busy-indicator if.bind="loading" class="margin-largest"></busy-indicator>

            <empty-indicator if.bind="!loading && orderedAndFilteredItems.length == 0" class="margin-largest">
                <div slot="heading" translate>No results</div>
            </empty-indicator>

        </page-section>

    </page-content>

</template>
