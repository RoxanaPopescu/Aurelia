<template
    class="${open ? '--open' : ''} ${filter != 'none' ? '--filter' : ''}"
    inert.bind="disabled || readonly"
    validation
    forward-focus>

    <require from="./time-input.scss"></require>

    <text-input
        ref="inputElement"
        value.bind="inputValue"
        label.bind="label & attr"
        disabled.bind="disabled"
        readonly.bind="filter === 'none' || readonly"
        autocomplete.bind="autocomplete"
        autoselect.bind="autoselect"
        mousedown.trigger="onInputMouseDown($event)"
        keydown.trigger="onInputKeyDown($event)"
        focusin.trigger="onInputFocusIn($event)"
        change.trigger="onInputChange($event)">

        <slot name="heading" slot="heading"></slot>
        <slot name="description" slot="description"></slot>
        <slot name="validation" slot="validation"></slot>
        <slot name="before" slot="before"></slot>

        <slot name="placeholder" slot="placeholder">
            <span class="opacity-faded-more">
                ${formatInfo.format | case: 'upper'}
            </span>
        </slot>

        <div slot="after">

            <slot name="after"></slot>

            <dropdown-icon
                ref="toggleElement"
                open.bind="open"
                toggle.call="toggleDropdown()">
            </dropdown-icon>

        </div>

        <div slot="validation">

            <custom-validator
                enabled.bind="!open"
                active.bind="true"
                valid.bind="isValid"
                trigger="change">

                <template replace-part="invalid" translate>
                    Please provide a valid time, formatted as <kbd>${formatInfo.format | case: 'upper'}</kbd>.
                </template>

            </custom-validator>

            <pattern-validator
                enabled.bind="open"
                active.bind="true"
                pattern.bind="formatInfo.partialPattern"
                trigger="input"
                value.bind="enteredValue">

                <template replace-part="invalid" translate>
                   Please provide a valid time, formatted as <kbd>${formatInfo.format | case: 'upper'}</kbd>.
                </template>

            </pattern-validator>

            <slot name="validation"></slot>

        </div>

        <dropdown
            show.bind="open"
            close.call="closeDropdown(escape, !escape)"
            mousedown.trigger="onDropdownMouseDown($event)"
            scroll>

            <item-picker
                value.bind="value"
                focused-value.bind="focusedValue"
                filter-value.bind="filterValue"
                focused-element.bind="inputElement"
                keyboard.bind="open"
                none.bind="none"
                pick.call="closeDropdown(true, true)"
                tabindex="-1">

                <item
                    repeat.for="item of items"
                    model.bind="item"
                    show.bind="item == null || (item.valueOf() >= min.valueOf() && item.valueOf() <= max.valueOf())"
                    disabled.bind="item != null && (item.valueOf() < min.valueOf() || item.valueOf() > max.valueOf())">
                    ${item | time}
                </item>

            </item-picker>

        </dropdown>

    </text-input>

</template>
